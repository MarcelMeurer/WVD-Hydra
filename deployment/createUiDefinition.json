{
   "$schema":"https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
   "handler":"Microsoft.Azure.CreateUIDef",
   "version":"0.1.2-preview",
   "parameters":{
      "resourceTypes":[
         "Microsoft.OperationalInsights/workspaces",
         "Microsoft.Sql/servers",
         "Microsoft.KeyVault/vaults",
         "Microsoft.Sql/servers",
         "Microsoft.Web/serverfarms",
         "Microsoft.Insights/components"
      ],
      "basics":[
         {
            "name":"siteName",
            "type":"Microsoft.Common.TextBox",
            "label":"Name of your deployment",
            "toolTip":"The name should include 1-49 letters, digits or '-'. The '-' shouldn't be the first symbol. The name will be appended by a unique identifier.",
            "constraints":{
               "required":true,
               "regex":"^[a-z0-9A-Z]{1}[a-z0-9A-Z-]{0,48}$",
               "validationMessage":"The name should include 1-49 letters, digits or '-'. The '-' shouldn't be the first symbol. The name will be appended by a unique identifier."
            }
         }
      ],
      "steps":[
         {
            "name":"ServicePrincipal",
            "label":"Service Principal",
            "elements":[
               {
                  "name":"textSp",
                  "type":"Microsoft.Common.TextBlock",
                  "visible":true,
                  "options":{
                     "text":"A service principal is needed to authenticate to the web app. Please create a service principal based on the documentation and enter the application id and secret. Optionally: Id and secret can be changed on the deployed Key Vault after the deployment. ",
                     "link":{
                        "label":"Learn more",
                        "uri":"https://github.com/MarcelMeurer/WVD-Hydra"
                     }
                  }
               },
               {
                  "name":"spId",
                  "type":"Microsoft.Common.TextBox",
                  "label":"Application Id",
                  "toolTip":"The application id of the service principal must be in the format '00000000-0000-0000-0000-000000000000'",
                  "constraints":{
                     "required":true,
                     "regex":"^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$",
                     "validationMessage":"The application id of the service principal must be in the format '00000000-0000-0000-0000-000000000000'"
                  }
               },
               {
                  "name":"spSecret",
                  "type":"Microsoft.Common.TextBox",
                  "label":"The secret of the service principal",
                  "toolTip":"A secret string with a least one character",
                  "constraints":{
                     "required":true,
                     "validationMessage":"A secret string with a least one character"
                  }
               }
            ]
         },
         {
            "name":"tags",
            "label":"Tags",
            "elements":[
               {
                  "name":"tagsByResource",
                  "type":"Microsoft.Common.TagsByResource",
                  "resources":[
                     "Microsoft.OperationalInsights/workspaces",
                     "Microsoft.Sql/servers",
                     "Microsoft.KeyVault/vaults",
                     "Microsoft.Sql/servers",
                     "Microsoft.Web/serverfarms",
                     "Microsoft.Insights/components"
                  ]
               }
            ]
         }
      ],
      "outputs":{
         "spId":"[steps('ServicePrincipal').spId]",
         "spSecret":"[steps('ServicePrincipal').spSecret]",
         "location":"[location()]",
         "siteName":"[basics('siteName')]",
         "tagsByResource":"[steps('tags').tagsByResource]"
      }
   }
}