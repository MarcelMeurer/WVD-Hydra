{
   "$schema":"https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
   "handler":"Microsoft.Azure.CreateUIDef",
   "version":"0.1.2-preview",
   "parameters":{
      "resourceTypes":[
         "Microsoft.OperationalInsights/workspaces",
         "Microsoft.Sql/servers",
         "Microsoft.KeyVault/vaults",
         "Microsoft.Sql/servers",
         "Microsoft.Web/serverfarms",
		 "Microsoft.Storage/storageAccounts",
		 "Microsoft.Web/sites"
      ],
      "basics":[
         {
            "name":"siteName",
            "type":"Microsoft.Common.TextBox",
            "label":"Name of your deployment",
            "toolTip":"The name should include 1-10 letters, digits or '-'. The '-' shouldn't be the first symbol. The name will be appended by a unique identifier.",
            "constraints":{
               "required":true,
               "regex":"^[a-z0-9A-Z]{1}[a-z0-9A-Z-]{0,9}$",
               "validationMessage":"The name should include 1-10 letters, digits or '-'. The '-' shouldn't be the first symbol. The name will be appended by a unique identifier."
            }
         }
      ],
      "steps":[
         {
            "name":"ServicePrincipal",
            "label":"Service Principal",
            "elements":[
               {
                  "name":"textSp",
                  "type":"Microsoft.Common.TextBlock",
                  "visible":true,
                  "options":{
                     "text":"A service principal is needed to authenticate to the web app. Please create a service principal based on the documentation and enter the application id and secret. Optionally: Id and secret can be changed on the deployed Key Vault after the deployment. ",
                     "link":{
                        "label":"Learn more",
                        "uri":"https://github.com/MarcelMeurer/WVD-Hydra"
                     }
                  }
               },
               {
                  "name":"spId",
                  "type":"Microsoft.Common.TextBox",
                  "label":"Application Id",
                  "toolTip":"The application id of the service principal must be in the format '00000000-0000-0000-0000-000000000000'",
                  "constraints":{
                     "required":true,
                     "regex":"^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$",
                     "validationMessage":"The application id of the service principal must be in the format '00000000-0000-0000-0000-000000000000'"
                  }
               },
               {
                  "name":"spSecret",
                  "type":"Microsoft.Common.PasswordBox",

				                  "label": {
                    "password": "The secret of the service principal",
                    "confirmPassword": "Confirm password"
                },
				                "options": {
                    "hideConfirmation": true
                },
                  "toolTip":"A secret string with a least one character",
                  "constraints":{
                     "required":true,
                     "validationMessage":"A secret string with a least one character"
                  }
               }
            ]
         },
         {
            "name":"Administration",
            "label":"Administration",
            "elements":[
               {
                  "name":"textAdmin",
                  "type":"Microsoft.Common.TextBlock",
                  "visible":true,
                  "options":{
                     "text":"Enter the UPN of the administrator, who should have unlimited permission in the solution - the user must exist or be invited in this tenant. This UPN can log on after the deployment and configuration. This setting can be changed in the configuration of the deployed web app. It's possible to add more users or groups (object ids of the groups) comma-delimited. E.g: 'admin@contoso.com'",
                     "link":{
                        "label":"Learn more",
                        "uri":"https://github.com/MarcelMeurer/WVD-Hydra"
                     }
                  }
               },
               {
                  "name":"admins",
                  "type":"Microsoft.Common.TextBox",
                  "label":"Administrator(s) of the solution",
                  "toolTip":"Comma-delimited list of full admins of the solutions (at least one UPN)",
                  "constraints":{
                     "required":true,
                     "regex":"^([\\w+-.%]+@[\\w-.]+\\.[A-Za-z]{2,4},?)+$",
                     "validationMessage":"At least one UPN mus be entered (admin@contoso.com)"
                  }
               }
            ]
         },
         {
            "name":"tags",
            "label":"Tags",
            "elements":[
               {
                  "name":"tagsByResource",
                  "type":"Microsoft.Common.TagsByResource",
                  "resources":[
                     "Microsoft.OperationalInsights/workspaces",
					 "Microsoft.Sql/servers",
                     "Microsoft.KeyVault/vaults",
                     "Microsoft.Web/serverfarms",
					 "Microsoft.Storage/storageAccounts",
					 "Microsoft.Web/sites"
                  ]
               }
            ]
         }
      ],
      "outputs":{
         "spId":"[steps('ServicePrincipal').spId]",
         "spSecret":"[steps('ServicePrincipal').spSecret]",
         "location":"[location()]",
         "siteName":"[basics('siteName')]",
         "admins":"[steps('Administration').admins]",
         "tagsByResource":"[steps('tags').tagsByResource]"
      }
   }
}