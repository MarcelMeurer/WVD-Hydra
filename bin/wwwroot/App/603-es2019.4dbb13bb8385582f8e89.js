(self.webpackChunkngx_admin=self.webpackChunkngx_admin||[]).push([[603],{3603:function(e,t,n){"use strict";n.r(t),n.d(t,{ProvisioningPoliciesModule:function(){return J}});var r=n(38583),i=n(10264),a=n(79765),l=n(46797),o=n(40205),s=n(25917),c=n(68307),u=n(11627),p=n(39761),m=n(43190),d=n(67666),g=n(5304),h=n(46782),f=n(11173),y=n(76897),v=n(14625),x=(()=>(function(e){e.TenantName="SceneName",e.Name="Resource.DisplayName",e.Image="Resource.ImageDisplayName",e.Experience="UserExperienceType",e.ImageStatus="Resource.ImageType",e.CreatedBy="Resource.CreatedBy",e.LicenseType="Resource.ProvisioningType"}(x||(x={})),x))(),C=(()=>(function(e){e[e.Gallery=0]="Gallery",e[e.Custom=1]="Custom",e[e.UnknownFutureValue=2]="UnknownFutureValue"}(C||(C={})),C))(),S=(()=>(function(e){e[e.Dedicated=0]="Dedicated",e[e.Shared=1]="Shared",e[e.UnknownFutureValue=2]="UnknownFutureValue",e[e.SharedByUser=3]="SharedByUser",e[e.SharedByEntraGroup=4]="SharedByEntraGroup",e[e.Reserve=5]="Reserve"}(S||(S={})),S))(),T=(()=>(function(e){e[e.CloudPc=0]="CloudPc",e[e.CloudApp=1]="CloudApp",e[e.UnknownFutureValue=2]="UnknownFutureValue"}(T||(T={})),T))();function b(e){switch(e){case T.CloudApp:case"CloudApp":return"Cloud App";case T.CloudPc:case"CloudPc":return"Cloud PC";case T.UnknownFutureValue:case"UnknownFutureValue":return"Unknown future value";default:return"null"}}function P(e){switch(e){case C.Gallery:return"Gallery";case C.Custom:return"Custom";case C.UnknownFutureValue:return"Unknown future value";default:return"null"}}function E(e){switch(e){case S.Dedicated:return"Dedicated";case S.Shared:return"Shared";case S.SharedByUser:return"Shared By User";case S.SharedByEntraGroup:return"Shared By Entra Group";case S.Reserve:return"Reserve";case S.UnknownFutureValue:return"Unknown future value";default:return"null"}}var w=n(45880),F=n(47349),R=n(92340),I=n(37716),k=n(91841);let V=(()=>{class e{constructor(e){this.httpClient=e,this.apiUrl=`${R.N.apiUrl}/data/scenes`,this.ALL_TENANTS_ID="00000000-0000-0000-0000-000000000000"}getProvisioningPolicies(){return this.httpClient.get(`${this.apiUrl}/${this.ALL_TENANTS_ID}/win365/provisioningpolicies`).pipe((0,F.d)({refCount:!0,bufferSize:1}))}}return e.\u0275fac=function(t){return new(t||e)(I["\u0275\u0275inject"](k.eN))},e.\u0275prov=I["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var N=n(60290),U=n(73544),A=n(84266);function D(e,t){1&e&&I["\u0275\u0275element"](0,"nb-spinner")}function B(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",13),I["\u0275\u0275listener"]("filtersChanges",function(t){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),I["\u0275\u0275elementEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"](2);I["\u0275\u0275property"]("fieldPath",e.sortKeys.TenantName)("dataSource",e.provisioningPoliciesCache)}}function $(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",14),I["\u0275\u0275listener"]("filtersChanges",function(t){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),I["\u0275\u0275elementEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"](2);I["\u0275\u0275property"]("fieldPath",e.sortKeys.Name)("dataSource",e.provisioningPoliciesCache)}}function L(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",15),I["\u0275\u0275listener"]("filtersChanges",function(t){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),I["\u0275\u0275elementEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"](2);I["\u0275\u0275property"]("fieldPath",e.sortKeys.Image)("dataSource",e.provisioningPoliciesCache)}}function j(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",16),I["\u0275\u0275listener"]("filtersChanges",function(t){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),I["\u0275\u0275elementEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"](2);I["\u0275\u0275property"]("dataSource",e.provisioningPoliciesCache)("extractSpecificValue",e.experienceValue)}}function _(e,t){if(1&e&&(I["\u0275\u0275elementStart"](0,"td"),I["\u0275\u0275text"](1),I["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=I["\u0275\u0275nextContext"](2);I["\u0275\u0275advance"](1),I["\u0275\u0275textInterpolate"]("null"===n.getExperienceText(e.UserExperienceType)?"":n.getExperienceText(e.UserExperienceType))}}function O(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",17),I["\u0275\u0275listener"]("filtersChanges",function(t){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),I["\u0275\u0275elementEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"](2);I["\u0275\u0275property"]("dataSource",e.provisioningPoliciesCache)("extractSpecificValue",e.imageTypeValue)}}function G(e,t){if(1&e&&(I["\u0275\u0275elementStart"](0,"td"),I["\u0275\u0275text"](1),I["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=I["\u0275\u0275nextContext"](2);I["\u0275\u0275advance"](1),I["\u0275\u0275textInterpolate"]("null"===n.getImageTypeText(null==e.Resource?null:e.Resource.ImageType)?"":n.getImageTypeText(null==e.Resource?null:e.Resource.ImageType))}}function K(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",18),I["\u0275\u0275listener"]("filtersChanges",function(t){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),I["\u0275\u0275elementEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"](2);I["\u0275\u0275property"]("fieldPath",e.sortKeys.CreatedBy)("dataSource",e.provisioningPoliciesCache)}}function M(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",19),I["\u0275\u0275listener"]("filtersChanges",function(t){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),I["\u0275\u0275elementEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"](2);I["\u0275\u0275property"]("dataSource",e.provisioningPoliciesCache)("extractSpecificValue",e.provisioningTypeValue)}}function z(e,t){if(1&e&&(I["\u0275\u0275elementStart"](0,"td"),I["\u0275\u0275text"](1),I["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=I["\u0275\u0275nextContext"](2);I["\u0275\u0275advance"](1),I["\u0275\u0275textInterpolate"]("null"===n.getProvisioningTypeText(null==e.Resource?null:e.Resource.ProvisioningType)?"":n.getProvisioningTypeText(null==e.Resource?null:e.Resource.ProvisioningType))}}function Q(e,t){if(1&e){const e=I["\u0275\u0275getCurrentView"]();I["\u0275\u0275elementContainerStart"](0),I["\u0275\u0275elementStart"](1,"ngx-data-table",1),I["\u0275\u0275listener"]("clearFiltersClick",function(){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"]().clearFilters()}),I["\u0275\u0275elementStart"](2,"ngx-table-column",2),I["\u0275\u0275template"](3,B,1,2,"ng-template",null,3,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](5,"ngx-table-column",4),I["\u0275\u0275template"](6,$,1,2,"ng-template",null,3,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](8,"ngx-table-column",5),I["\u0275\u0275template"](9,L,1,2,"ng-template",null,3,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](11,"ngx-table-column",6),I["\u0275\u0275template"](12,j,1,2,"ng-template",null,3,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275template"](14,_,2,1,"ng-template",null,7,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](16,"ngx-table-column",8),I["\u0275\u0275template"](17,O,1,2,"ng-template",null,3,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275template"](19,G,2,1,"ng-template",null,7,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](21,"ngx-table-column",9),I["\u0275\u0275template"](22,K,1,2,"ng-template",null,3,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](24,"ngx-table-column",10),I["\u0275\u0275template"](25,M,1,2,"ng-template",null,3,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275template"](27,z,2,1,"ng-template",null,7,I["\u0275\u0275templateRefExtractor"]),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](29,"button",11),I["\u0275\u0275listener"]("click",function(){return I["\u0275\u0275restoreView"](e),I["\u0275\u0275nextContext"]().update()}),I["\u0275\u0275element"](30,"nb-icon",12),I["\u0275\u0275text"](31," Update "),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=I["\u0275\u0275nextContext"]();I["\u0275\u0275advance"](1),I["\u0275\u0275property"]("data",e.provisioningPolicies)("config",e.tableConfig)("columnFilters",e.filterState.columnFilters),I["\u0275\u0275advance"](1),I["\u0275\u0275property"]("sortable",!0)("searchable",!0),I["\u0275\u0275advance"](3),I["\u0275\u0275property"]("sortable",!0)("searchable",!0),I["\u0275\u0275advance"](3),I["\u0275\u0275property"]("sortable",!0)("searchable",!0),I["\u0275\u0275advance"](3),I["\u0275\u0275property"]("sortable",!0)("searchable",!0)("searchTransform",e.experienceSearchTransform),I["\u0275\u0275advance"](5),I["\u0275\u0275property"]("sortable",!0)("searchable",!0)("searchTransform",e.imageTypeSearchTransform),I["\u0275\u0275advance"](5),I["\u0275\u0275property"]("sortable",!0)("searchable",!0),I["\u0275\u0275advance"](3),I["\u0275\u0275property"]("sortable",!0)("searchable",!0)("searchTransform",e.provisioningTypeSearchTransform)}}const H=[{path:"",component:(()=>{class e{constructor(e,t,n){this.provisioningPoliciesService=e,this.toastrService=t,this.cdr=n,this.destroyed$=new a.xQ,this.filterState={searchQuery:"",columnFilters:{}},this.provisioningPolicies$=new a.xQ,this.provisioningPolicies=[],this.provisioningPoliciesCache=[],this.isLoading=!1,this.sortKeys=x,this.tableConfig={id:"ProvisioningPolicies",search:{placeholder:"Search for tenant, name, image, or creator"}},this.experienceSearchTransform=e=>{var t;return null!==(t=b(e))&&void 0!==t?t:""},this.imageTypeSearchTransform=e=>{var t;return null!==(t=P(e))&&void 0!==t?t:""},this.provisioningTypeSearchTransform=e=>{var t;return null!==(t=E(e))&&void 0!==t?t:""},this.experienceValue=e=>b(e.UserExperienceType),this.imageTypeValue=e=>{var t;return P(null===(t=e.Resource)||void 0===t?void 0:t.ImageType)},this.provisioningTypeValue=e=>{var t;return E(null===(t=e.Resource)||void 0===t?void 0:t.ProvisioningType)},this.getExperienceText=b,this.getImageTypeText=P,this.getProvisioningTypeText=E,this.retryApiCallWithToastCallback=e=>e.pipe((0,c.b)(e=>this.showDangerToast("Failure accessing the API",`Cannot read data from API. The message is: ${e.message} with status ${e.statusText}`)),(0,u.j)(()=>(0,l.H)(y.e5))),this.handleApiErrorCallback=e=>(0,o._)(()=>(this.showDangerToast("Failure accessing the API",`Cannot read data from API. Reload this site to try it again. The message is: ${e.message} with status ${e.statusText}`),(0,s.of)([])))}ngOnInit(){this.initProvisioningPolicies()}clearFilters(){var e;this.filterState={...this.filterState,columnFilters:{}},null===(e=this.filterTriggers)||void 0===e||e.forEach(e=>e.resetAllFilters()),this.applyAllFilters()}update(){this.provisioningPolicies$.next()}populateFiltersSet([e,t]){const n=e.filter(e=>e.checked).map(e=>e.label.toLowerCase());this.filterState={...this.filterState,columnFilters:{...this.filterState.columnFilters,[t]:n}},this.applyAllFilters()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}initProvisioningPolicies(){this.isLoading=!0,this.provisioningPolicies$.pipe((0,p.O)(0),(0,m.w)(()=>(0,l.H)(0,f.tc.autoRefreshDefault)),(0,m.w)(()=>this.provisioningPoliciesService.getProvisioningPolicies()),(0,d.a)(this.retryApiCallWithToastCallback),(0,g.K)(this.handleApiErrorCallback),(0,h.R)(this.destroyed$)).subscribe(e=>{this.provisioningPoliciesCache=[...e],this.applyAllFilters(),this.isLoading=!1,this.cdr.markForCheck()})}applyAllFilters(){let e=[...this.provisioningPoliciesCache];Object.keys(this.filterState.columnFilters).some(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0})&&(e=this.applyColumnFilters(e)),this.provisioningPolicies=e,this.cdr.markForCheck()}applyColumnFilters(e){const t=Object.keys(this.filterState.columnFilters).filter(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0});return t.length?e.filter(e=>t.every(t=>{var n;const r=this.filterState.columnFilters[t],i=null===(n=this.getTableCellValue(e,t))||void 0===n?void 0:n.toLowerCase();return r.includes(i)})):e}showDangerToast(e,t){this.toastrService.danger(t,e,{destroyByClick:!0,duration:2e4,hasIcon:!0,position:v.fe3.TOP_RIGHT,preventDuplicates:!0})}getTableCellValue(e,t){var n,r,i,a,l;switch(t){case"SceneName":return e.SceneName;case"DisplayName":return null===(n=e.Resource)||void 0===n?void 0:n.DisplayName;case"ImageDisplayName":return null===(r=e.Resource)||void 0===r?void 0:r.ImageDisplayName;case"UserExperienceType":return b(e.UserExperienceType);case"ImageType":return P(null===(i=e.Resource)||void 0===i?void 0:i.ImageType);case"CreatedBy":return null===(a=e.Resource)||void 0===a?void 0:a.CreatedBy;case"ProvisioningType":return E(null===(l=e.Resource)||void 0===l?void 0:l.ProvisioningType);default:return""}}}return e.\u0275fac=function(t){return new(t||e)(I["\u0275\u0275directiveInject"](V),I["\u0275\u0275directiveInject"](v.quB),I["\u0275\u0275directiveInject"](I.ChangeDetectorRef))},e.\u0275cmp=I["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-provisioning-policies"]],viewQuery:function(e,t){if(1&e&&I["\u0275\u0275viewQuery"](w.m4,5),2&e){let e;I["\u0275\u0275queryRefresh"](e=I["\u0275\u0275loadQuery"]())&&(t.filterTriggers=e)}},decls:7,vars:2,consts:[[4,"ngIf"],[3,"data","config","columnFilters","clearFiltersClick"],["key","SceneName","label","Tenant",3,"sortable","searchable"],["headerFilter",""],["key","Resource.DisplayName","label","Name",3,"sortable","searchable"],["key","Resource.ImageDisplayName","label","Image",3,"sortable","searchable"],["key","UserExperienceType","label","Experience",3,"sortable","searchable","searchTransform"],["cell",""],["key","Resource.ImageType","label","Image status",3,"sortable","searchable","searchTransform"],["key","Resource.CreatedBy","label","Created by",3,"sortable","searchable"],["key","Resource.ProvisioningType","label","License type",3,"sortable","searchable","searchTransform"],["type","button","nbButton","","status","semi-round",3,"click"],["icon","refresh"],["filterName","SceneName",3,"fieldPath","dataSource","filtersChanges"],["filterName","DisplayName",3,"fieldPath","dataSource","filtersChanges"],["filterName","ImageDisplayName",3,"fieldPath","dataSource","filtersChanges"],["filterName","UserExperienceType",3,"dataSource","extractSpecificValue","filtersChanges"],["filterName","ImageType",3,"dataSource","extractSpecificValue","filtersChanges"],["filterName","CreatedBy",3,"fieldPath","dataSource","filtersChanges"],["filterName","ProvisioningType",3,"dataSource","extractSpecificValue","filtersChanges"]],template:function(e,t){1&e&&(I["\u0275\u0275elementStart"](0,"nb-card"),I["\u0275\u0275elementStart"](1,"nb-card-header"),I["\u0275\u0275elementStart"](2,"h1"),I["\u0275\u0275text"](3,"Provisioning Policies"),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementStart"](4,"nb-card-body"),I["\u0275\u0275template"](5,D,1,0,"nb-spinner",0),I["\u0275\u0275template"](6,Q,32,20,"ng-container",0),I["\u0275\u0275elementEnd"](),I["\u0275\u0275elementEnd"]()),2&e&&(I["\u0275\u0275advance"](5),I["\u0275\u0275property"]("ngIf",t.isLoading),I["\u0275\u0275advance"](1),I["\u0275\u0275property"]("ngIf",!t.isLoading))},directives:[v.Asz,v.ndF,v.yKW,r.O5,v.Tzq,N.Q,U.U,v.DPz,v.fMN,A.m],styles:["[_nghost-%COMP%]{height:100%}[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{height:100%}"],changeDetection:0}),e})()}];let q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=I["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=I["\u0275\u0275defineInjector"]({imports:[[i.Bz.forChild(H)],i.Bz]}),e})();var W=n(66911),X=n(3679),Y=n(88100),Z=n(14171);let J=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=I["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=I["\u0275\u0275defineInjector"]({imports:[[r.ez,q,W.m,v.zyh,v.KdK,v.T2N,v.uuI,v.MAY,v.MfT,v.rgH,X.UX,w.H8,Y.Z,Z.tA]]}),e})()}}]);