(self.webpackChunkngx_admin=self.webpackChunkngx_admin||[]).push([[227],{39227:function(e,t,n){"use strict";n.r(t),n.d(t,{SnapshotImportsModule:function(){return q}});var a=n(38583),s=n(10264),r=n(79765),i=n(46797),l=n(40205),o=n(25917),c=n(94402),p=n(45435),h=n(46782),d=n(39761),m=n(5304),u=n(68307),f=n(11627),g=n(43190),S=n(19773),b=n(68939),C=n(67666),x=n(11173),y=n(14625),I=n(45880),v=n(27861),E=n(30110),T=(()=>(function(e){e.TenantName="SceneName",e.AssignedUserPrincipalName="AssignedUserPrincipalNameResolved",e.UsageStatus="UsageStatus",e.ImportStatus="ImportStatus",e.StartDate="StartDateTime",e.EndDate="EndDateTime"}(T||(T={})),T))(),w=n(76897),F=n(47349),k=n(92340),P=n(37716),A=n(91841);let N=(()=>{class e{constructor(e){this.httpClient=e,this.apiUrl=`${k.N.apiUrl}/data/scenes`,this.ALL_TENANTS_ID="00000000-0000-0000-0000-000000000000"}getClouPcMigrationSnapshots(){return this.httpClient.get(`${this.apiUrl}/${this.ALL_TENANTS_ID}/win365/snapshotImports`).pipe((0,F.d)({refCount:!0,bufferSize:1}))}}return e.\u0275fac=function(t){return new(t||e)(P["\u0275\u0275inject"](A.eN))},e.\u0275prov=P["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var D=n(60290),U=n(73544),$=n(84266);function R(e,t){1&e&&P["\u0275\u0275element"](0,"nb-spinner")}function M(e,t){if(1&e){const e=P["\u0275\u0275getCurrentView"]();P["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",17),P["\u0275\u0275listener"]("filtersChanges",function(t){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),P["\u0275\u0275elementEnd"]()}if(2&e){const e=P["\u0275\u0275nextContext"](2);P["\u0275\u0275property"]("fieldPath",e.sortKeys.TenantName)("dataSource",e.snapshotImportsCache)}}function j(e,t){if(1&e){const e=P["\u0275\u0275getCurrentView"]();P["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",18),P["\u0275\u0275listener"]("filtersChanges",function(t){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),P["\u0275\u0275elementEnd"]()}if(2&e){const e=P["\u0275\u0275nextContext"](2);P["\u0275\u0275property"]("fieldPath",e.sortKeys.AssignedUserPrincipalName)("dataSource",e.snapshotImportsCache)}}function O(e,t){if(1&e){const e=P["\u0275\u0275getCurrentView"]();P["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",19),P["\u0275\u0275listener"]("filtersChanges",function(t){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),P["\u0275\u0275elementEnd"]()}if(2&e){const e=P["\u0275\u0275nextContext"](2);P["\u0275\u0275property"]("fieldPath",e.sortKeys.UsageStatus)("dataSource",e.snapshotImportsCache)}}function V(e,t){if(1&e){const e=P["\u0275\u0275getCurrentView"]();P["\u0275\u0275elementStart"](0,"ngx-table-filter-trigger",20),P["\u0275\u0275listener"]("filtersChanges",function(t){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),P["\u0275\u0275elementEnd"]()}if(2&e){const e=P["\u0275\u0275nextContext"](2);P["\u0275\u0275property"]("fieldPath",e.sortKeys.ImportStatus)("dataSource",e.snapshotImportsCache)}}function _(e,t){if(1&e&&(P["\u0275\u0275elementStart"](0,"td"),P["\u0275\u0275text"](1),P["\u0275\u0275pipe"](2,"date"),P["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;P["\u0275\u0275advance"](1),P["\u0275\u0275textInterpolate"](P["\u0275\u0275pipeBind2"](2,1,e.StartDateTime,"short"))}}function B(e,t){if(1&e&&(P["\u0275\u0275elementStart"](0,"td"),P["\u0275\u0275text"](1),P["\u0275\u0275pipe"](2,"date"),P["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;P["\u0275\u0275advance"](1),P["\u0275\u0275textInterpolate"](P["\u0275\u0275pipeBind2"](2,1,e.EndDateTime,"short"))}}function z(e,t){if(1&e){const e=P["\u0275\u0275getCurrentView"]();P["\u0275\u0275elementContainerStart"](0),P["\u0275\u0275elementStart"](1,"ngx-data-table",1,2),P["\u0275\u0275listener"]("clearFiltersClick",function(){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"]().clearFilters()})("selectionChange",function(t){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"]().selectionChange(t)}),P["\u0275\u0275elementStart"](3,"div",3),P["\u0275\u0275elementStart"](4,"nb-actions",4),P["\u0275\u0275elementStart"](5,"nb-action",5),P["\u0275\u0275listener"]("click",function(){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"]().deleteSelectedSnapshots()}),P["\u0275\u0275element"](6,"nb-icon",6),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](7,"ngx-table-column",7),P["\u0275\u0275template"](8,M,1,2,"ng-template",null,8,P["\u0275\u0275templateRefExtractor"]),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](10,"ngx-table-column",9),P["\u0275\u0275template"](11,j,1,2,"ng-template",null,8,P["\u0275\u0275templateRefExtractor"]),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](13,"ngx-table-column",10),P["\u0275\u0275template"](14,O,1,2,"ng-template",null,8,P["\u0275\u0275templateRefExtractor"]),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](16,"ngx-table-column",11),P["\u0275\u0275template"](17,V,1,2,"ng-template",null,8,P["\u0275\u0275templateRefExtractor"]),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](19,"ngx-table-column",12),P["\u0275\u0275template"](20,_,3,4,"ng-template",null,13,P["\u0275\u0275templateRefExtractor"]),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](22,"ngx-table-column",14),P["\u0275\u0275template"](23,B,3,4,"ng-template",null,13,P["\u0275\u0275templateRefExtractor"]),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](25,"button",15),P["\u0275\u0275listener"]("click",function(){return P["\u0275\u0275restoreView"](e),P["\u0275\u0275nextContext"]().update()}),P["\u0275\u0275element"](26,"nb-icon",16),P["\u0275\u0275text"](27," Update "),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=P["\u0275\u0275reference"](2),t=P["\u0275\u0275nextContext"]();P["\u0275\u0275advance"](1),P["\u0275\u0275property"]("data",t.snapshotImports)("config",t.tableConfig)("columnFilters",t.filterState.columnFilters),P["\u0275\u0275advance"](4),P["\u0275\u0275propertyInterpolate"]("nbTooltip",e.hasSelection?"Delete":"Select at least one item in the table to delete migration snapshots"),P["\u0275\u0275property"]("disabled",!e.hasSelection),P["\u0275\u0275advance"](2),P["\u0275\u0275property"]("sortable",!0)("searchable",!0),P["\u0275\u0275advance"](3),P["\u0275\u0275property"]("sortable",!0)("searchable",!0),P["\u0275\u0275advance"](3),P["\u0275\u0275property"]("sortable",!0)("searchable",!0),P["\u0275\u0275advance"](3),P["\u0275\u0275property"]("sortable",!0)("searchable",!0),P["\u0275\u0275advance"](3),P["\u0275\u0275property"]("sortable",!0)("searchable",!1),P["\u0275\u0275advance"](3),P["\u0275\u0275property"]("sortable",!0)("searchable",!1)}}const L=[{path:"**",redirectTo:"migration-snapshots",pathMatch:"full"},{path:"",component:(()=>{class e{constructor(e,t,n,a,s){this.snapshotImportsService=e,this.toastrService=t,this.actionsService=n,this.dialogService=a,this.cdr=s,this.destroyed$=new r.xQ,this.selectedSnapshots=[],this.snapshotImports$=new r.xQ,this.filterState={searchQuery:"",columnFilters:{}},this.tableConfig={id:"SnapshotImports",search:{placeholder:"Search for tenant, user principal name, or status"},selectionKey:"IsSelected"},this.sortKeys=T,this.snapshotImports=[],this.snapshotImportsCache=[],this.isLoading=!1,this.retryApiCallWithToastCallback=e=>e.pipe((0,u.b)(e=>this.showDangerToast("Failure accessing the API",`Cannot read data from API. The message is: ${e.message} with status ${e.statusText}`)),(0,f.j)(()=>(0,i.H)(w.e5))),this.handleApiErrorCallback=e=>(0,l._)(()=>(this.showDangerToast("Failure accessing the API",`Cannot read data from API. Reload this site to try it again. The message is: ${e.message} with status ${e.statusText}`),(0,o.of)([])))}ngOnInit(){this.initMigrationSnapshots()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}update(){this.snapshotImports$.next()}populateFiltersSet([e,t]){const n=e.filter(e=>e.checked).map(e=>e.label.toLowerCase());this.filterState={...this.filterState,columnFilters:{...this.filterState.columnFilters,[t]:n}},this.applyAllFilters()}clearFilters(){var e;this.filterState={...this.filterState,columnFilters:{}},null===(e=this.filterTriggers)||void 0===e||e.forEach(e=>e.resetAllFilters()),this.applyAllFilters()}selectionChange(e){this.selectedSnapshots=this.snapshotImports.filter(t=>e.includes(t.Id))}deleteSelectedSnapshots(){if(0===this.selectedSnapshots.length)return;const{onClose:e}=this.dialogService.open(E.z,{context:{headerTitle:"Delete migration snapshot(s)",bodyText:`Please confirm deletion of ${this.selectedSnapshots.length} migration snapshot(s)`,cancelButtonText:"Cancel",confirmButtonText:"Delete"},hasScroll:!1,closeOnEsc:!1,closeOnBackdropClick:!1});e.pipe((0,p.h)(Boolean),(0,g.w)(()=>(0,c.D)(this.selectedSnapshots).pipe((0,S.zg)(e=>this.actionsService.sendActionAsync(`scenes/${e.SceneId}/win365/snapshotImports/${e.SnapshotId}/deletecloudpcsnapshotimport`,null,"Delete snapshot import",e.AssignedUserPrincipalNameResolved),3))),(0,b.x)(()=>this.update()),(0,h.R)(this.destroyed$)).subscribe()}initMigrationSnapshots(){this.isLoading=!0,this.snapshotImports$.pipe((0,d.O)(0),(0,g.w)(()=>(0,i.H)(0,x.tc.autoRefreshDefault)),(0,g.w)(()=>this.snapshotImportsService.getClouPcMigrationSnapshots()),(0,C.a)(this.retryApiCallWithToastCallback),(0,m.K)(this.handleApiErrorCallback),(0,h.R)(this.destroyed$)).subscribe(e=>{const t=e.map(e=>({...e,Id:e.SnapshotId}));this.snapshotImportsCache=[...t],this.applyAllFilters(),this.isLoading=!1,this.cdr.markForCheck()})}showDangerToast(e,t){this.toastrService.danger(t,e,{destroyByClick:!0,duration:2e4,hasIcon:!0,position:y.fe3.TOP_RIGHT,preventDuplicates:!0})}applyAllFilters(){let e=[...this.snapshotImportsCache];Object.keys(this.filterState.columnFilters).some(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0})&&(e=this.applyColumnFilters(e)),this.snapshotImports=e,this.cdr.markForCheck()}applyColumnFilters(e){const t=Object.keys(this.filterState.columnFilters).filter(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0});return t.length?e.filter(e=>t.every(t=>{var n;const a=this.filterState.columnFilters[t],s=null===(n=this.getTableCellValue(e,t))||void 0===n?void 0:n.toLowerCase();return a.includes(s)})):e}getTableCellValue(e,t){switch(t){case"SceneName":return e.SceneName;case"AssignedUserPrincipalNameResolved":return e.AssignedUserPrincipalNameResolved;case"UsageStatus":return e.UsageStatus;case"ImportStatus":return e.ImportStatus;default:return""}}}return e.\u0275fac=function(t){return new(t||e)(P["\u0275\u0275directiveInject"](N),P["\u0275\u0275directiveInject"](y.quB),P["\u0275\u0275directiveInject"](v.c),P["\u0275\u0275directiveInject"](y.Gln),P["\u0275\u0275directiveInject"](P.ChangeDetectorRef))},e.\u0275cmp=P["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-snapshotImports"]],viewQuery:function(e,t){if(1&e&&P["\u0275\u0275viewQuery"](I.m4,5),2&e){let e;P["\u0275\u0275queryRefresh"](e=P["\u0275\u0275loadQuery"]())&&(t.filterTriggers=e)}},decls:7,vars:2,consts:[[4,"ngIf"],[3,"data","config","columnFilters","clearFiltersClick","selectionChange"],["dataTable",""],["data-table-actions","",1,"d-flex","align-items-center"],["size","small"],["nbTooltipPlacement","top",3,"disabled","nbTooltip","click"],["icon","trash-2-outline"],["key","SceneName","label","Tenant name",3,"sortable","searchable"],["headerFilter",""],["key","AssignedUserPrincipalNameResolved","label","User principal name",3,"sortable","searchable"],["key","UsageStatus","label","Usage status",3,"sortable","searchable"],["key","ImportStatus","label","Import status",3,"sortable","searchable"],["key","StartDateTime","label","Start date",3,"sortable","searchable"],["cell",""],["key","EndDateTime","label","End date",3,"sortable","searchable"],["type","button","nbButton","","status","semi-round",3,"click"],["icon","refresh"],["filterName","SceneName",3,"fieldPath","dataSource","filtersChanges"],["filterName","AssignedUserPrincipalNameResolved",3,"fieldPath","dataSource","filtersChanges"],["filterName","UsageStatus",3,"fieldPath","dataSource","filtersChanges"],["filterName","ImportStatus",3,"fieldPath","dataSource","filtersChanges"]],template:function(e,t){1&e&&(P["\u0275\u0275elementStart"](0,"nb-card"),P["\u0275\u0275elementStart"](1,"nb-card-header"),P["\u0275\u0275elementStart"](2,"h1"),P["\u0275\u0275text"](3,"Migration snapshots"),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementStart"](4,"nb-card-body"),P["\u0275\u0275template"](5,R,1,0,"nb-spinner",0),P["\u0275\u0275template"](6,z,28,17,"ng-container",0),P["\u0275\u0275elementEnd"](),P["\u0275\u0275elementEnd"]()),2&e&&(P["\u0275\u0275advance"](5),P["\u0275\u0275property"]("ngIf",t.isLoading),P["\u0275\u0275advance"](1),P["\u0275\u0275property"]("ngIf",!t.isLoading))},directives:[y.Asz,y.ndF,y.yKW,a.O5,y.Tzq,D.Q,y.lYD,y.Bk3,y.jNv,y.fMN,U.U,y.DPz,$.m],pipes:[a.uU],styles:["[_nghost-%COMP%]{height:100%}[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   nb-actions[_ngcontent-%COMP%]   nb-action[_ngcontent-%COMP%]:not(.disabled){cursor:pointer}"],changeDetection:0}),e})()}];let K=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=P["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=P["\u0275\u0275defineInjector"]({imports:[[s.Bz.forChild(L)],s.Bz]}),e})();var Q=n(66911),H=n(14171);let q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=P["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=P["\u0275\u0275defineInjector"]({imports:[[a.ez,K,Q.m,y.zyh,y.KdK,y.T2N,y.uuI,y.MAY,y.rgH,I.H8,H.tA]]}),e})()}}]);