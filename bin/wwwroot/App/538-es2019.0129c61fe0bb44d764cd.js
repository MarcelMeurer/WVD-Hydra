(self.webpackChunkngx_admin=self.webpackChunkngx_admin||[]).push([[538],{66538:function(e,t,r){"use strict";r.r(t),r.d(t,{ProvisioningPoliciesModule:function(){return ee}});var n=r(38583),i=r(10264),a=r(79765),s=r(46797),o=r(40205),l=r(25917),c=r(68307),u=r(11627),p=r(39761),h=r(43190),d=r(67666),m=r(5304),g=r(46782),f=r(11173),y=r(76897),v=r(14625),C=r(34681),x=(()=>(function(e){e.TenantName="SceneName",e.Name="Resource.DisplayName",e.Image="Resource.ImageDisplayName",e.Experience="UserExperienceType",e.ImageStatus="Resource.ImageType",e.CreatedBy="Resource.CreatedBy",e.LicenseType="Resource.ProvisioningType"}(x||(x={})),x))(),S=(()=>(function(e){e[e.Gallery=0]="Gallery",e[e.Custom=1]="Custom",e[e.UnknownFutureValue=2]="UnknownFutureValue"}(S||(S={})),S))(),b=(()=>(function(e){e[e.Dedicated=0]="Dedicated",e[e.Shared=1]="Shared",e[e.UnknownFutureValue=2]="UnknownFutureValue",e[e.SharedByUser=3]="SharedByUser",e[e.SharedByEntraGroup=4]="SharedByEntraGroup",e[e.Reserve=5]="Reserve"}(b||(b={})),b))(),P=(()=>(function(e){e[e.CloudPc=0]="CloudPc",e[e.CloudApp=1]="CloudApp",e[e.UnknownFutureValue=2]="UnknownFutureValue"}(P||(P={})),P))();function T(e){switch(e){case P.CloudApp:case"CloudApp":return"Cloud App";case P.CloudPc:case"CloudPc":return"Cloud PC";case P.UnknownFutureValue:case"UnknownFutureValue":return"Unknown future value";default:return"null"}}function w(e){switch(e){case S.Gallery:return"Gallery";case S.Custom:return"Custom";case S.UnknownFutureValue:return"Unknown future value";default:return"null"}}function E(e){switch(e){case b.Dedicated:return"Dedicated";case b.Shared:return"Shared";case b.SharedByUser:return"Shared By User";case b.SharedByEntraGroup:return"Shared By Entra Group";case b.Reserve:return"Reserve";case b.UnknownFutureValue:return"Unknown future value";default:return"null"}}var F=r(37716),R=r(47010);const k=["popoverRef"];function I(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-table-filter-popover",4),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"]().filtersChanged(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"]();F["\u0275\u0275property"]("filters",e.filters)("filterName",e.filterName)}}const N=function(e){return{"filters-applied":e}};let V=(()=>{class e{constructor(){this.dataSource=[],this.filtersChanges=new F.EventEmitter,this.filters=[],this.areFiltersApplied=!1,this.valueMapper=e=>{var t,r;switch(this.resourcePath){case x.Experience:return T(e.UserExperienceType);case x.ImageStatus:return w(null===(t=e.Resource)||void 0===t?void 0:t.ImageType);case x.LicenseType:return E(null===(r=e.Resource)||void 0===r?void 0:r.ProvisioningType);default:return this.getObjectValueByResourcePath(e,this.resourcePath)}},this.getObjectValueByResourcePath=(e,t)=>null==t?void 0:t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}ngOnInit(){this.buildFilters()}filtersChanged(e){var t;this.areFiltersApplied=e[0].some(e=>e.checked),this.filtersChanges.emit(e),null===(t=this.popoverRef)||void 0===t||t.hide()}buildFilters(){var e;if(!(null===(e=this.dataSource)||void 0===e?void 0:e.length)||!this.resourcePath)return;const t=new Set(this.dataSource.map(this.valueMapper)),r=Array.from(t);this.filters=r.map(e=>({label:e,checked:!1}))}resetAllFilters(){this.filters=this.filters.map(e=>({...e,checked:!1})),this.areFiltersApplied=!1,this.filtersChanged([this.filters,this.filterName])}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=F["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-provisioning-policies-filter-trigger"]],viewQuery:function(e,t){if(1&e&&F["\u0275\u0275viewQuery"](k,7),2&e){let e;F["\u0275\u0275queryRefresh"](e=F["\u0275\u0275loadQuery"]())&&(t.popoverRef=e.first)}},inputs:{resourcePath:"resourcePath",filterName:"filterName",dataSource:"dataSource"},outputs:{filtersChanges:"filtersChanges"},decls:5,vars:5,consts:[["nbButton","","size","tiny","nbPopoverTrigger","focus","nbPopoverPlacement","bottom",3,"ngClass","nbPopover","disabled","click"],["popoverRef","nbPopover"],["icon","funnel"],["tableFilterPopoverTpl",""],[3,"filters","filterName","filtersChanges"]],template:function(e,t){if(1&e&&(F["\u0275\u0275elementStart"](0,"button",0,1),F["\u0275\u0275listener"]("click",function(e){return e.stopPropagation()}),F["\u0275\u0275element"](2,"nb-icon",2),F["\u0275\u0275elementEnd"](),F["\u0275\u0275template"](3,I,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"])),2&e){const e=F["\u0275\u0275reference"](4);F["\u0275\u0275property"]("ngClass",F["\u0275\u0275pureFunction1"](3,N,t.areFiltersApplied))("nbPopover",e)("disabled",!t.dataSource.length)}},directives:[v.DPz,n.mk,v.ydg,v.fMN,R.D],styles:['[_nghost-%COMP%]{display:block;position:relative}[_nghost-%COMP%]   button.filters-applied[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-.188em;right:-.188em;width:.7em;height:.7em;border-radius:50%;background-color:var(--primary)}']}),e})();var U=r(60290),A=r(73544);function D(e,t){1&e&&F["\u0275\u0275element"](0,"nb-spinner")}function B(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-provisioning-policies-filter-trigger",13),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"](2);F["\u0275\u0275property"]("resourcePath",e.sortKeys.TenantName)("dataSource",e.provisioningPoliciesCache)}}function O(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-provisioning-policies-filter-trigger",14),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"](2);F["\u0275\u0275property"]("resourcePath",e.sortKeys.Name)("dataSource",e.provisioningPoliciesCache)}}function M(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-provisioning-policies-filter-trigger",15),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"](2);F["\u0275\u0275property"]("resourcePath",e.sortKeys.Image)("dataSource",e.provisioningPoliciesCache)}}function $(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-provisioning-policies-filter-trigger",16),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"](2);F["\u0275\u0275property"]("resourcePath",e.sortKeys.Experience)("dataSource",e.provisioningPoliciesCache)}}function j(e,t){if(1&e&&(F["\u0275\u0275elementStart"](0,"td"),F["\u0275\u0275text"](1),F["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,r=F["\u0275\u0275nextContext"](2);F["\u0275\u0275advance"](1),F["\u0275\u0275textInterpolate"]("null"===r.getExperienceText(e.UserExperienceType)?"":r.getExperienceText(e.UserExperienceType))}}function K(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-provisioning-policies-filter-trigger",17),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"](2);F["\u0275\u0275property"]("resourcePath",e.sortKeys.ImageStatus)("dataSource",e.provisioningPoliciesCache)}}function L(e,t){if(1&e&&(F["\u0275\u0275elementStart"](0,"td"),F["\u0275\u0275text"](1),F["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,r=F["\u0275\u0275nextContext"](2);F["\u0275\u0275advance"](1),F["\u0275\u0275textInterpolate"]("null"===r.getImageTypeText(null==e.Resource?null:e.Resource.ImageType)?"":r.getImageTypeText(null==e.Resource?null:e.Resource.ImageType))}}function G(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-provisioning-policies-filter-trigger",18),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"](2);F["\u0275\u0275property"]("resourcePath",e.sortKeys.CreatedBy)("dataSource",e.provisioningPoliciesCache)}}function Q(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementStart"](0,"ngx-provisioning-policies-filter-trigger",19),F["\u0275\u0275listener"]("filtersChanges",function(t){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),F["\u0275\u0275elementEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"](2);F["\u0275\u0275property"]("resourcePath",e.sortKeys.LicenseType)("dataSource",e.provisioningPoliciesCache)}}function _(e,t){if(1&e&&(F["\u0275\u0275elementStart"](0,"td"),F["\u0275\u0275text"](1),F["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,r=F["\u0275\u0275nextContext"](2);F["\u0275\u0275advance"](1),F["\u0275\u0275textInterpolate"]("null"===r.getProvisioningTypeText(null==e.Resource?null:e.Resource.ProvisioningType)?"":r.getProvisioningTypeText(null==e.Resource?null:e.Resource.ProvisioningType))}}function z(e,t){if(1&e){const e=F["\u0275\u0275getCurrentView"]();F["\u0275\u0275elementContainerStart"](0),F["\u0275\u0275elementStart"](1,"ngx-data-table",1),F["\u0275\u0275listener"]("clearFiltersClick",function(){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"]().clearFilters()}),F["\u0275\u0275elementStart"](2,"ngx-table-column",2),F["\u0275\u0275template"](3,B,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](5,"ngx-table-column",4),F["\u0275\u0275template"](6,O,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](8,"ngx-table-column",5),F["\u0275\u0275template"](9,M,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](11,"ngx-table-column",6),F["\u0275\u0275template"](12,$,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275template"](14,j,2,1,"ng-template",null,7,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](16,"ngx-table-column",8),F["\u0275\u0275template"](17,K,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275template"](19,L,2,1,"ng-template",null,7,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](21,"ngx-table-column",9),F["\u0275\u0275template"](22,G,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](24,"ngx-table-column",10),F["\u0275\u0275template"](25,Q,1,2,"ng-template",null,3,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275template"](27,_,2,1,"ng-template",null,7,F["\u0275\u0275templateRefExtractor"]),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](29,"button",11),F["\u0275\u0275listener"]("click",function(){return F["\u0275\u0275restoreView"](e),F["\u0275\u0275nextContext"]().update()}),F["\u0275\u0275element"](30,"nb-icon",12),F["\u0275\u0275text"](31," Update "),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=F["\u0275\u0275nextContext"]();F["\u0275\u0275advance"](1),F["\u0275\u0275property"]("data",e.provisioningPolicies)("config",e.tableConfig)("columnFilters",e.filterState.columnFilters),F["\u0275\u0275advance"](1),F["\u0275\u0275property"]("sortable",!0)("searchable",!0),F["\u0275\u0275advance"](3),F["\u0275\u0275property"]("sortable",!0)("searchable",!0),F["\u0275\u0275advance"](3),F["\u0275\u0275property"]("sortable",!0)("searchable",!0),F["\u0275\u0275advance"](3),F["\u0275\u0275property"]("sortable",!0)("searchable",!0)("searchTransform",e.experienceSearchTransform),F["\u0275\u0275advance"](5),F["\u0275\u0275property"]("sortable",!0)("searchable",!0)("searchTransform",e.imageTypeSearchTransform),F["\u0275\u0275advance"](5),F["\u0275\u0275property"]("sortable",!0)("searchable",!0),F["\u0275\u0275advance"](3),F["\u0275\u0275property"]("sortable",!0)("searchable",!0)("searchTransform",e.provisioningTypeSearchTransform)}}const H=[{path:"",component:(()=>{class e{constructor(e,t,r){this.wd365Service=e,this.toastrService=t,this.cdr=r,this.destroyed$=new a.xQ,this.filterState={searchQuery:"",columnFilters:{}},this.provisioningPolicies$=new a.xQ,this.provisioningPolicies=[],this.provisioningPoliciesCache=[],this.isLoading=!1,this.sortKeys=x,this.tableConfig={id:"ProvisioningPolicies",search:{placeholder:"Search for tenant, name, image, or creator"}},this.experienceSearchTransform=e=>{var t;return null!==(t=T(e))&&void 0!==t?t:""},this.imageTypeSearchTransform=e=>{var t;return null!==(t=w(e))&&void 0!==t?t:""},this.provisioningTypeSearchTransform=e=>{var t;return null!==(t=E(e))&&void 0!==t?t:""},this.getExperienceText=T,this.getImageTypeText=w,this.getProvisioningTypeText=E,this.retryApiCallWithToastCallback=e=>e.pipe((0,c.b)(e=>this.showDangerToast("Failure accessing the API",`Cannot read data from API. The message is: ${e.message} with status ${e.statusText}`)),(0,u.j)(()=>(0,s.H)(y.e5))),this.handleApiErrorCallback=e=>(0,o._)(()=>(this.showDangerToast("Failure accessing the API",`Cannot read data from API. Reload this site to try it again. The message is: ${e.message} with status ${e.statusText}`),(0,l.of)([])))}ngOnInit(){this.initProvisioningPolicies()}clearFilters(){var e;this.filterState={...this.filterState,columnFilters:{}},null===(e=this.filterTriggers)||void 0===e||e.forEach(e=>e.resetAllFilters()),this.applyAllFilters()}update(){this.provisioningPolicies$.next()}populateFiltersSet([e,t]){const r=e.filter(e=>e.checked).map(e=>e.label.toLowerCase());this.filterState={...this.filterState,columnFilters:{...this.filterState.columnFilters,[t]:r}},this.applyAllFilters()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}initProvisioningPolicies(){this.isLoading=!0,this.provisioningPolicies$.pipe((0,p.O)(0),(0,h.w)(()=>(0,s.H)(0,f.tc.autoRefreshDefault)),(0,h.w)(()=>this.wd365Service.getProvisioningPolicies()),(0,d.a)(this.retryApiCallWithToastCallback),(0,m.K)(this.handleApiErrorCallback),(0,g.R)(this.destroyed$)).subscribe(e=>{this.provisioningPoliciesCache=[...e],this.applyAllFilters(),this.isLoading=!1,this.cdr.markForCheck()})}applyAllFilters(){let e=[...this.provisioningPoliciesCache];Object.keys(this.filterState.columnFilters).some(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0})&&(e=this.applyColumnFilters(e)),this.provisioningPolicies=e,this.cdr.markForCheck()}applyColumnFilters(e){const t=Object.keys(this.filterState.columnFilters).filter(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0});return t.length?e.filter(e=>t.every(t=>{var r;const n=this.filterState.columnFilters[t],i=null===(r=this.getTableCellValue(e,t))||void 0===r?void 0:r.toLowerCase();return n.includes(i)})):e}showDangerToast(e,t){this.toastrService.danger(t,e,{destroyByClick:!0,duration:2e4,hasIcon:!0,position:v.fe3.TOP_RIGHT,preventDuplicates:!0})}getTableCellValue(e,t){var r,n,i,a,s;switch(t){case"SceneName":return e.SceneName;case"DisplayName":return null===(r=e.Resource)||void 0===r?void 0:r.DisplayName;case"ImageDisplayName":return null===(n=e.Resource)||void 0===n?void 0:n.ImageDisplayName;case"UserExperienceType":return T(e.UserExperienceType);case"ImageType":return w(null===(i=e.Resource)||void 0===i?void 0:i.ImageType);case"CreatedBy":return null===(a=e.Resource)||void 0===a?void 0:a.CreatedBy;case"ProvisioningType":return E(null===(s=e.Resource)||void 0===s?void 0:s.ProvisioningType);default:return""}}}return e.\u0275fac=function(t){return new(t||e)(F["\u0275\u0275directiveInject"](C.G),F["\u0275\u0275directiveInject"](v.quB),F["\u0275\u0275directiveInject"](F.ChangeDetectorRef))},e.\u0275cmp=F["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-provisioning-policies"]],viewQuery:function(e,t){if(1&e&&F["\u0275\u0275viewQuery"](V,5),2&e){let e;F["\u0275\u0275queryRefresh"](e=F["\u0275\u0275loadQuery"]())&&(t.filterTriggers=e)}},decls:7,vars:2,consts:[[4,"ngIf"],[3,"data","config","columnFilters","clearFiltersClick"],["key","SceneName","label","Tenant",3,"sortable","searchable"],["headerFilter",""],["key","Resource.DisplayName","label","Name",3,"sortable","searchable"],["key","Resource.ImageDisplayName","label","Image",3,"sortable","searchable"],["key","UserExperienceType","label","Experience",3,"sortable","searchable","searchTransform"],["cell",""],["key","Resource.ImageType","label","Image status",3,"sortable","searchable","searchTransform"],["key","Resource.CreatedBy","label","Created by",3,"sortable","searchable"],["key","Resource.ProvisioningType","label","License type",3,"sortable","searchable","searchTransform"],["type","button","nbButton","","status","semi-round",3,"click"],["icon","refresh"],["filterName","SceneName",3,"resourcePath","dataSource","filtersChanges"],["filterName","DisplayName",3,"resourcePath","dataSource","filtersChanges"],["filterName","ImageDisplayName",3,"resourcePath","dataSource","filtersChanges"],["filterName","UserExperienceType",3,"resourcePath","dataSource","filtersChanges"],["filterName","ImageType",3,"resourcePath","dataSource","filtersChanges"],["filterName","CreatedBy",3,"resourcePath","dataSource","filtersChanges"],["filterName","ProvisioningType",3,"resourcePath","dataSource","filtersChanges"]],template:function(e,t){1&e&&(F["\u0275\u0275elementStart"](0,"nb-card"),F["\u0275\u0275elementStart"](1,"nb-card-header"),F["\u0275\u0275elementStart"](2,"h1"),F["\u0275\u0275text"](3,"Provisioning Policies"),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementStart"](4,"nb-card-body"),F["\u0275\u0275template"](5,D,1,0,"nb-spinner",0),F["\u0275\u0275template"](6,z,32,20,"ng-container",0),F["\u0275\u0275elementEnd"](),F["\u0275\u0275elementEnd"]()),2&e&&(F["\u0275\u0275advance"](5),F["\u0275\u0275property"]("ngIf",t.isLoading),F["\u0275\u0275advance"](1),F["\u0275\u0275property"]("ngIf",!t.isLoading))},directives:[v.Asz,v.ndF,v.yKW,n.O5,v.Tzq,U.Q,A.U,v.DPz,v.fMN,V],styles:["[_nghost-%COMP%]{height:100%}[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{height:100%}"],changeDetection:0}),e})()}];let q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=F["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=F["\u0275\u0275defineInjector"]({imports:[[i.Bz.forChild(H)],i.Bz]}),e})();var W=r(66911),X=r(3679),Y=r(61367),Z=r(88100),J=r(14171);let ee=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=F["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=F["\u0275\u0275defineInjector"]({imports:[[n.ez,q,W.m,v.zyh,v.KdK,v.T2N,v.uuI,v.MAY,v.MfT,v.rgH,X.UX,Y.H,Z.Z,J.tA,v.spT]]}),e})()}}]);