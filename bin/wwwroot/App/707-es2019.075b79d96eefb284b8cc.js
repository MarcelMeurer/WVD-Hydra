(self.webpackChunkngx_admin=self.webpackChunkngx_admin||[]).push([[707],{30110:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var r=n(37716),s=n(14625),a=n(38583);function i(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"button",2),r["\u0275\u0275listener"]("click",function(){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().close()}),r["\u0275\u0275text"](1),r["\u0275\u0275elementEnd"]()}if(2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate"](e.cancelButtonText)}}function o(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"button",2),r["\u0275\u0275listener"]("click",function(){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().confirm()}),r["\u0275\u0275text"](1),r["\u0275\u0275elementEnd"]()}if(2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate"](e.confirmButtonText)}}let l=(()=>{class e{constructor(e){this.dialogRef=e}close(){this.dialogRef.close()}confirm(){this.dialogRef.close(!0)}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](s.X4l))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-confirmation-dialog"]],inputs:{headerTitle:"headerTitle",bodyText:"bodyText",confirmButtonText:"confirmButtonText",cancelButtonText:"cancelButtonText"},decls:8,vars:4,consts:[[1,"d-flex","justify-content-between"],["nbButton","",3,"click",4,"ngIf"],["nbButton","",3,"click"]],template:function(e,t){1&e&&(r["\u0275\u0275elementStart"](0,"nb-card"),r["\u0275\u0275elementStart"](1,"nb-card-header"),r["\u0275\u0275text"](2),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](3,"nb-card-body"),r["\u0275\u0275text"](4),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](5,"nb-card-footer",0),r["\u0275\u0275template"](6,i,2,1,"button",1),r["\u0275\u0275template"](7,o,2,1,"button",1),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()),2&e&&(r["\u0275\u0275advance"](2),r["\u0275\u0275textInterpolate"](t.headerTitle),r["\u0275\u0275advance"](2),r["\u0275\u0275textInterpolate"](t.bodyText),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngIf",t.cancelButtonText),r["\u0275\u0275advance"](1),r["\u0275\u0275property"]("ngIf",t.confirmButtonText))},directives:[s.Asz,s.ndF,s.yKW,s.XWE,a.O5,s.DPz],styles:["[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]   nb-card-footer[_ngcontent-%COMP%]{grid-gap:1rem;gap:1rem}"]}),e})()},41707:function(e,t,n){"use strict";n.r(t),n.d(t,{SnapshotImportsModule:function(){return q}});var r=n(38583),s=n(10264),a=n(79765),i=n(46797),o=n(40205),l=n(25917),c=n(94402),p=n(45435),d=n(46782),h=n(39761),u=n(5304),m=n(68307),f=n(11627),g=n(43190),b=n(19773),S=n(68939),C=n(67666),x=n(11173),v=n(14625),y=n(34681),I=n(27861),P=n(30110),T=(()=>(function(e){e.TenantName="SceneName",e.AssignedUserPrincipalName="AssignedUserPrincipalNameResolved",e.UsageStatus="UsageStatus",e.ImportStatus="ImportStatus",e.StartDate="StartDateTime",e.EndDate="EndDateTime"}(T||(T={})),T))(),w=n(76897),E=n(37716),F=n(47010);const k=["popoverRef"];function A(e,t){if(1&e){const e=E["\u0275\u0275getCurrentView"]();E["\u0275\u0275elementStart"](0,"ngx-table-filter-popover",4),E["\u0275\u0275listener"]("filtersChanges",function(t){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"]().filtersChanged(t)}),E["\u0275\u0275elementEnd"]()}if(2&e){const e=E["\u0275\u0275nextContext"]();E["\u0275\u0275property"]("filters",e.filters)("filterName",e.filterName)}}const N=function(e){return{"filters-applied":e}};let R=(()=>{class e{constructor(){this.dataSource=[],this.filtersChanges=new E.EventEmitter,this.filters=[],this.areFiltersApplied=!1,this.getObjectValueByResourcePath=(e,t)=>null==t?void 0:t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}ngOnInit(){this.buildFilters()}filtersChanged(e){var t;this.areFiltersApplied=e[0].some(e=>e.checked),this.filtersChanges.emit(e),null===(t=this.popoverRef)||void 0===t||t.hide()}buildFilters(){var e;if(!(null===(e=this.dataSource)||void 0===e?void 0:e.length)||!this.resourcePath)return;const t=new Set(this.dataSource.map(e=>this.getObjectValueByResourcePath(e,this.resourcePath))),n=Array.from(t);this.filters=n.map(e=>({label:e,checked:!1}))}resetAllFilters(){this.filters=this.filters.map(e=>({...e,checked:!1})),this.areFiltersApplied=!1,this.filtersChanged([this.filters,this.filterName])}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=E["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-snapshot-imports-filter-trigger"]],viewQuery:function(e,t){if(1&e&&E["\u0275\u0275viewQuery"](k,7),2&e){let e;E["\u0275\u0275queryRefresh"](e=E["\u0275\u0275loadQuery"]())&&(t.popoverRef=e.first)}},inputs:{resourcePath:"resourcePath",filterName:"filterName",dataSource:"dataSource"},outputs:{filtersChanges:"filtersChanges"},decls:5,vars:5,consts:[["nbButton","","size","tiny","nbPopoverTrigger","focus","nbPopoverPlacement","bottom",3,"ngClass","nbPopover","disabled","click"],["popoverRef","nbPopover"],["icon","funnel"],["tableFilterPopoverTpl",""],[3,"filters","filterName","filtersChanges"]],template:function(e,t){if(1&e&&(E["\u0275\u0275elementStart"](0,"button",0,1),E["\u0275\u0275listener"]("click",function(e){return e.stopPropagation()}),E["\u0275\u0275element"](2,"nb-icon",2),E["\u0275\u0275elementEnd"](),E["\u0275\u0275template"](3,A,1,2,"ng-template",null,3,E["\u0275\u0275templateRefExtractor"])),2&e){const e=E["\u0275\u0275reference"](4);E["\u0275\u0275property"]("ngClass",E["\u0275\u0275pureFunction1"](3,N,t.areFiltersApplied))("nbPopover",e)("disabled",!t.dataSource.length&&!t.areFiltersApplied)}},directives:[v.DPz,r.mk,v.ydg,v.fMN,F.D],styles:['[_nghost-%COMP%]{display:block;position:relative}[_nghost-%COMP%]   button.filters-applied[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-.188em;right:-.188em;width:.7em;height:.7em;border-radius:50%;background-color:var(--primary)}']}),e})();var D=n(60290),B=n(73544);function O(e,t){1&e&&E["\u0275\u0275element"](0,"nb-spinner")}function M(e,t){if(1&e){const e=E["\u0275\u0275getCurrentView"]();E["\u0275\u0275elementStart"](0,"ngx-snapshot-imports-filter-trigger",17),E["\u0275\u0275listener"]("filtersChanges",function(t){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),E["\u0275\u0275elementEnd"]()}if(2&e){const e=E["\u0275\u0275nextContext"](2);E["\u0275\u0275property"]("resourcePath",e.sortKeys.TenantName)("dataSource",e.snapshotImportsCache)}}function V(e,t){if(1&e){const e=E["\u0275\u0275getCurrentView"]();E["\u0275\u0275elementStart"](0,"ngx-snapshot-imports-filter-trigger",18),E["\u0275\u0275listener"]("filtersChanges",function(t){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),E["\u0275\u0275elementEnd"]()}if(2&e){const e=E["\u0275\u0275nextContext"](2);E["\u0275\u0275property"]("resourcePath",e.sortKeys.AssignedUserPrincipalName)("dataSource",e.snapshotImportsCache)}}function U(e,t){if(1&e){const e=E["\u0275\u0275getCurrentView"]();E["\u0275\u0275elementStart"](0,"ngx-snapshot-imports-filter-trigger",19),E["\u0275\u0275listener"]("filtersChanges",function(t){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),E["\u0275\u0275elementEnd"]()}if(2&e){const e=E["\u0275\u0275nextContext"](2);E["\u0275\u0275property"]("resourcePath",e.sortKeys.UsageStatus)("dataSource",e.snapshotImportsCache)}}function j(e,t){if(1&e){const e=E["\u0275\u0275getCurrentView"]();E["\u0275\u0275elementStart"](0,"ngx-snapshot-imports-filter-trigger",20),E["\u0275\u0275listener"]("filtersChanges",function(t){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),E["\u0275\u0275elementEnd"]()}if(2&e){const e=E["\u0275\u0275nextContext"](2);E["\u0275\u0275property"]("resourcePath",e.sortKeys.ImportStatus)("dataSource",e.snapshotImportsCache)}}function $(e,t){if(1&e&&(E["\u0275\u0275elementStart"](0,"td"),E["\u0275\u0275text"](1),E["\u0275\u0275pipe"](2,"date"),E["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;E["\u0275\u0275advance"](1),E["\u0275\u0275textInterpolate"](E["\u0275\u0275pipeBind2"](2,1,e.StartDateTime,"short"))}}function _(e,t){if(1&e&&(E["\u0275\u0275elementStart"](0,"td"),E["\u0275\u0275text"](1),E["\u0275\u0275pipe"](2,"date"),E["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;E["\u0275\u0275advance"](1),E["\u0275\u0275textInterpolate"](E["\u0275\u0275pipeBind2"](2,1,e.EndDateTime,"short"))}}function z(e,t){if(1&e){const e=E["\u0275\u0275getCurrentView"]();E["\u0275\u0275elementContainerStart"](0),E["\u0275\u0275elementStart"](1,"ngx-data-table",1,2),E["\u0275\u0275listener"]("clearFiltersClick",function(){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"]().clearFilters()})("selectionChange",function(t){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"]().selectionChange(t)}),E["\u0275\u0275elementStart"](3,"div",3),E["\u0275\u0275elementStart"](4,"nb-actions",4),E["\u0275\u0275elementStart"](5,"nb-action",5),E["\u0275\u0275listener"]("click",function(){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"]().deleteSelectedSnapshots()}),E["\u0275\u0275element"](6,"nb-icon",6),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](7,"ngx-table-column",7),E["\u0275\u0275template"](8,M,1,2,"ng-template",null,8,E["\u0275\u0275templateRefExtractor"]),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](10,"ngx-table-column",9),E["\u0275\u0275template"](11,V,1,2,"ng-template",null,8,E["\u0275\u0275templateRefExtractor"]),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](13,"ngx-table-column",10),E["\u0275\u0275template"](14,U,1,2,"ng-template",null,8,E["\u0275\u0275templateRefExtractor"]),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](16,"ngx-table-column",11),E["\u0275\u0275template"](17,j,1,2,"ng-template",null,8,E["\u0275\u0275templateRefExtractor"]),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](19,"ngx-table-column",12),E["\u0275\u0275template"](20,$,3,4,"ng-template",null,13,E["\u0275\u0275templateRefExtractor"]),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](22,"ngx-table-column",14),E["\u0275\u0275template"](23,_,3,4,"ng-template",null,13,E["\u0275\u0275templateRefExtractor"]),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](25,"button",15),E["\u0275\u0275listener"]("click",function(){return E["\u0275\u0275restoreView"](e),E["\u0275\u0275nextContext"]().update()}),E["\u0275\u0275element"](26,"nb-icon",16),E["\u0275\u0275text"](27," Update "),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=E["\u0275\u0275reference"](2),t=E["\u0275\u0275nextContext"]();E["\u0275\u0275advance"](1),E["\u0275\u0275property"]("data",t.snapshotImports)("config",t.tableConfig)("columnFilters",t.filterState.columnFilters),E["\u0275\u0275advance"](4),E["\u0275\u0275propertyInterpolate"]("nbTooltip",e.hasSelection?"Delete":"Select at least one item in the table to delete migration snapshots"),E["\u0275\u0275property"]("disabled",!e.hasSelection),E["\u0275\u0275advance"](2),E["\u0275\u0275property"]("sortable",!0)("searchable",!0),E["\u0275\u0275advance"](3),E["\u0275\u0275property"]("sortable",!0)("searchable",!0),E["\u0275\u0275advance"](3),E["\u0275\u0275property"]("sortable",!0)("searchable",!0),E["\u0275\u0275advance"](3),E["\u0275\u0275property"]("sortable",!0)("searchable",!0),E["\u0275\u0275advance"](3),E["\u0275\u0275property"]("sortable",!0)("searchable",!1),E["\u0275\u0275advance"](3),E["\u0275\u0275property"]("sortable",!0)("searchable",!1)}}const K=[{path:"**",redirectTo:"migration-snapshots",pathMatch:"full"},{path:"",component:(()=>{class e{constructor(e,t,n,r,s){this.wd365Service=e,this.toastrService=t,this.actionsService=n,this.dialogService=r,this.cdr=s,this.destroyed$=new a.xQ,this.selectedSnapshots=[],this.snapshotImports$=new a.xQ,this.filterState={searchQuery:"",columnFilters:{}},this.tableConfig={id:"SnapshotImports",search:{placeholder:"Search for tenant, user principal name, or status"},selectionKey:"IsSelected"},this.sortKeys=T,this.snapshotImports=[],this.snapshotImportsCache=[],this.isLoading=!1,this.retryApiCallWithToastCallback=e=>e.pipe((0,m.b)(e=>this.showDangerToast("Failure accessing the API",`Cannot read data from API. The message is: ${e.message} with status ${e.statusText}`)),(0,f.j)(()=>(0,i.H)(w.e5))),this.handleApiErrorCallback=e=>(0,o._)(()=>(this.showDangerToast("Failure accessing the API",`Cannot read data from API. Reload this site to try it again. The message is: ${e.message} with status ${e.statusText}`),(0,l.of)([])))}ngOnInit(){this.initMigrationSnapshots()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}update(){this.snapshotImports$.next()}populateFiltersSet([e,t]){const n=e.filter(e=>e.checked).map(e=>e.label.toLowerCase());this.filterState={...this.filterState,columnFilters:{...this.filterState.columnFilters,[t]:n}},this.applyAllFilters()}clearFilters(){var e;this.filterState={...this.filterState,columnFilters:{}},null===(e=this.filterTriggers)||void 0===e||e.forEach(e=>e.resetAllFilters()),this.applyAllFilters()}selectionChange(e){this.selectedSnapshots=this.snapshotImports.filter(t=>e.includes(t.Id))}deleteSelectedSnapshots(){if(0===this.selectedSnapshots.length)return;const{onClose:e}=this.dialogService.open(P.z,{context:{headerTitle:"Delete migration snapshot(s)",bodyText:`Please confirm deletion of ${this.selectedSnapshots.length} migration snapshot(s)`,cancelButtonText:"Cancel",confirmButtonText:"Delete"},hasScroll:!1,closeOnEsc:!1,closeOnBackdropClick:!1});e.pipe((0,p.h)(Boolean),(0,g.w)(()=>(0,c.D)(this.selectedSnapshots).pipe((0,b.zg)(e=>this.actionsService.sendActionAsync(`scenes/${e.SceneId}/win365/snapshotImports/${e.SnapshotId}/deletecloudpcsnapshotimport`,null,"Delete snapshot import",e.AssignedUserPrincipalNameResolved),3))),(0,S.x)(()=>this.update()),(0,d.R)(this.destroyed$)).subscribe()}initMigrationSnapshots(){this.isLoading=!0,this.snapshotImports$.pipe((0,h.O)(0),(0,g.w)(()=>(0,i.H)(0,x.tc.autoRefreshDefault)),(0,g.w)(()=>this.wd365Service.getClouPcMigrationSnapshots()),(0,C.a)(this.retryApiCallWithToastCallback),(0,u.K)(this.handleApiErrorCallback),(0,d.R)(this.destroyed$)).subscribe(e=>{const t=e.map(e=>({...e,Id:e.SnapshotId}));this.snapshotImportsCache=[...t],this.applyAllFilters(),this.isLoading=!1,this.cdr.markForCheck()})}showDangerToast(e,t){this.toastrService.danger(t,e,{destroyByClick:!0,duration:2e4,hasIcon:!0,position:v.fe3.TOP_RIGHT,preventDuplicates:!0})}applyAllFilters(){let e=[...this.snapshotImportsCache];Object.keys(this.filterState.columnFilters).some(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0})&&(e=this.applyColumnFilters(e)),this.snapshotImports=e,this.cdr.markForCheck()}applyColumnFilters(e){const t=Object.keys(this.filterState.columnFilters).filter(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0});return t.length?e.filter(e=>t.every(t=>{var n;const r=this.filterState.columnFilters[t],s=null===(n=this.getTableCellValue(e,t))||void 0===n?void 0:n.toLowerCase();return r.includes(s)})):e}getTableCellValue(e,t){switch(t){case"SceneName":return e.SceneName;case"AssignedUserPrincipalNameResolved":return e.AssignedUserPrincipalNameResolved;case"UsageStatus":return e.UsageStatus;case"ImportStatus":return e.ImportStatus;default:return""}}}return e.\u0275fac=function(t){return new(t||e)(E["\u0275\u0275directiveInject"](y.G),E["\u0275\u0275directiveInject"](v.quB),E["\u0275\u0275directiveInject"](I.c),E["\u0275\u0275directiveInject"](v.Gln),E["\u0275\u0275directiveInject"](E.ChangeDetectorRef))},e.\u0275cmp=E["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-snapshotImports"]],viewQuery:function(e,t){if(1&e&&E["\u0275\u0275viewQuery"](R,5),2&e){let e;E["\u0275\u0275queryRefresh"](e=E["\u0275\u0275loadQuery"]())&&(t.filterTriggers=e)}},decls:7,vars:2,consts:[[4,"ngIf"],[3,"data","config","columnFilters","clearFiltersClick","selectionChange"],["dataTable",""],["data-table-actions","",1,"d-flex","align-items-center"],["size","small"],["nbTooltipPlacement","top",3,"disabled","nbTooltip","click"],["icon","trash-2-outline"],["key","SceneName","label","Tenant name",3,"sortable","searchable"],["headerFilter",""],["key","AssignedUserPrincipalNameResolved","label","User principal name",3,"sortable","searchable"],["key","UsageStatus","label","Usage status",3,"sortable","searchable"],["key","ImportStatus","label","Import status",3,"sortable","searchable"],["key","StartDateTime","label","Start date",3,"sortable","searchable"],["cell",""],["key","EndDateTime","label","End date",3,"sortable","searchable"],["type","button","nbButton","","status","semi-round",3,"click"],["icon","refresh"],["filterName","SceneName",3,"resourcePath","dataSource","filtersChanges"],["filterName","AssignedUserPrincipalNameResolved",3,"resourcePath","dataSource","filtersChanges"],["filterName","UsageStatus",3,"resourcePath","dataSource","filtersChanges"],["filterName","ImportStatus",3,"resourcePath","dataSource","filtersChanges"]],template:function(e,t){1&e&&(E["\u0275\u0275elementStart"](0,"nb-card"),E["\u0275\u0275elementStart"](1,"nb-card-header"),E["\u0275\u0275elementStart"](2,"h1"),E["\u0275\u0275text"](3,"Migration snapshots"),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementStart"](4,"nb-card-body"),E["\u0275\u0275template"](5,O,1,0,"nb-spinner",0),E["\u0275\u0275template"](6,z,28,17,"ng-container",0),E["\u0275\u0275elementEnd"](),E["\u0275\u0275elementEnd"]()),2&e&&(E["\u0275\u0275advance"](5),E["\u0275\u0275property"]("ngIf",t.isLoading),E["\u0275\u0275advance"](1),E["\u0275\u0275property"]("ngIf",!t.isLoading))},directives:[v.Asz,v.ndF,v.yKW,r.O5,v.Tzq,D.Q,v.lYD,v.Bk3,v.jNv,v.fMN,B.U,v.DPz,R],pipes:[r.uU],styles:["[_nghost-%COMP%]{height:100%}[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   nb-actions[_ngcontent-%COMP%]   nb-action[_ngcontent-%COMP%]:not(.disabled){cursor:pointer}"],changeDetection:0}),e})()}];let Q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=E["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=E["\u0275\u0275defineInjector"]({imports:[[s.Bz.forChild(K)],s.Bz]}),e})();var L=n(66911),H=n(61367),W=n(14171);let q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=E["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=E["\u0275\u0275defineInjector"]({imports:[[r.ez,Q,L.m,v.zyh,v.KdK,v.T2N,v.uuI,v.MAY,v.rgH,v.spT,H.H,W.tA]]}),e})()}}]);