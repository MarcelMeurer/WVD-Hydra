(self.webpackChunkngx_admin=self.webpackChunkngx_admin||[]).push([[707],{41707:function(e,t,n){"use strict";n.r(t),n.d(t,{SnapshotImportsModule:function(){return Se}});var r=n(38583),i=n(99763),s=n(79765),a=n(46797),o=n(40205),l=n(25917),c=n(94402),p=n(45435),d=n(46782),h=n(39761),u=n(5304),m=n(54395),g=n(87519),f=n(68307),S=n(11627),C=n(43190),y=n(19773),v=n(68939),b=n(67666),x=n(11173),I=n(9857),P=n(3679),E=n(34681),w=n(27861),T=n(30110),F=(()=>(function(e){e.TenantName="SceneName",e.AssignedUserPrincipalName="AssignedUserPrincipalNameResolved",e.UsageStatus="UsageStatus",e.ImportStatus="ImportStatus",e.StartDate="StartDateTime",e.EndDate="EndDateTime"}(F||(F={})),F))(),k=n(76897),O=n(37716),N=n(47010);const A=["popoverRef"];function z(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementStart"](0,"ngx-table-filter-popover",4),O["\u0275\u0275listener"]("filtersChanges",function(t){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"]().filtersChanged(t)}),O["\u0275\u0275elementEnd"]()}if(2&e){const e=O["\u0275\u0275nextContext"]();O["\u0275\u0275property"]("filters",e.filters)("filterName",e.filterName)}}const M=function(e){return{"filters-applied":e}};let V=(()=>{class e{constructor(){this.dataSource=[],this.filtersChanges=new O.EventEmitter,this.filters=[],this.areFiltersApplied=!1,this.getObjectValueByResourcePath=(e,t)=>null==t?void 0:t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}ngOnInit(){this.buildFilters()}filtersChanged(e){var t;this.areFiltersApplied=e[0].some(e=>e.checked),this.filtersChanges.emit(e),null===(t=this.popoverRef)||void 0===t||t.hide()}buildFilters(){var e;if(!(null===(e=this.dataSource)||void 0===e?void 0:e.length)||!this.resourcePath)return;const t=new Set(this.dataSource.map(e=>this.getObjectValueByResourcePath(e,this.resourcePath))),n=Array.from(t);this.filters=n.map(e=>({label:e,checked:!1}))}resetAllFilters(){this.filters=this.filters.map(e=>({...e,checked:!1})),this.areFiltersApplied=!1,this.filtersChanged([this.filters,this.filterName])}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=O["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-snapshot-imports-filter-trigger"]],viewQuery:function(e,t){if(1&e&&O["\u0275\u0275viewQuery"](A,7),2&e){let e;O["\u0275\u0275queryRefresh"](e=O["\u0275\u0275loadQuery"]())&&(t.popoverRef=e.first)}},inputs:{resourcePath:"resourcePath",filterName:"filterName",dataSource:"dataSource"},outputs:{filtersChanges:"filtersChanges"},decls:5,vars:5,consts:[["nbButton","","size","tiny","nbPopoverTrigger","focus","nbPopoverPlacement","bottom",3,"ngClass","nbPopover","disabled","click"],["popoverRef","nbPopover"],["icon","funnel"],["tableFilterPopoverTpl",""],[3,"filters","filterName","filtersChanges"]],template:function(e,t){if(1&e&&(O["\u0275\u0275elementStart"](0,"button",0,1),O["\u0275\u0275listener"]("click",function(e){return e.stopPropagation()}),O["\u0275\u0275element"](2,"nb-icon",2),O["\u0275\u0275elementEnd"](),O["\u0275\u0275template"](3,z,1,2,"ng-template",null,3,O["\u0275\u0275templateRefExtractor"])),2&e){const e=O["\u0275\u0275reference"](4);O["\u0275\u0275property"]("ngClass",O["\u0275\u0275pureFunction1"](3,M,t.areFiltersApplied))("nbPopover",e)("disabled",!t.dataSource.length&&!t.areFiltersApplied)}},directives:[I.DPz,r.mk,I.ydg,I.fMN,N.D],styles:['[_nghost-%COMP%]{display:block;position:relative}[_nghost-%COMP%]   button.filters-applied[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-.188em;right:-.188em;width:.7em;height:.7em;border-radius:50%;background-color:var(--primary)}']}),e})();var _=n(1816),D=n(69517);function B(e,t){1&e&&O["\u0275\u0275element"](0,"nb-spinner")}function L(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementStart"](0,"button",27),O["\u0275\u0275listener"]("click",function(){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"](2).clearSearch()}),O["\u0275\u0275element"](1,"nb-icon",28),O["\u0275\u0275elementEnd"]()}}function R(e,t){1&e&&O["\u0275\u0275elementContainer"](0)}function U(e,t){1&e&&O["\u0275\u0275elementContainer"](0)}function j(e,t){1&e&&O["\u0275\u0275elementContainer"](0)}function $(e,t){1&e&&O["\u0275\u0275elementContainer"](0)}function K(e,t){1&e&&O["\u0275\u0275elementContainer"](0)}function H(e,t){1&e&&O["\u0275\u0275elementContainer"](0)}function Q(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementContainerStart"](0),O["\u0275\u0275elementStart"](1,"tr"),O["\u0275\u0275elementStart"](2,"td"),O["\u0275\u0275elementStart"](3,"nb-checkbox",30),O["\u0275\u0275listener"]("checkedChange",function(t){const n=O["\u0275\u0275restoreView"](e).$implicit;return O["\u0275\u0275nextContext"](3).selectionChanged(n,t)}),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](4,"td"),O["\u0275\u0275text"](5),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](6,"td"),O["\u0275\u0275text"](7),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](8,"td"),O["\u0275\u0275text"](9),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](10,"td"),O["\u0275\u0275text"](11),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](12,"td"),O["\u0275\u0275text"](13),O["\u0275\u0275pipe"](14,"date"),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](15,"td"),O["\u0275\u0275text"](16),O["\u0275\u0275pipe"](17,"date"),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=t.$implicit;O["\u0275\u0275advance"](3),O["\u0275\u0275property"]("checked",e.IsSelected),O["\u0275\u0275advance"](2),O["\u0275\u0275textInterpolate"](e.SceneName),O["\u0275\u0275advance"](2),O["\u0275\u0275textInterpolate1"](" ",e.AssignedUserPrincipalNameResolved," "),O["\u0275\u0275advance"](2),O["\u0275\u0275textInterpolate"](e.UsageStatus),O["\u0275\u0275advance"](2),O["\u0275\u0275textInterpolate"](e.ImportStatus),O["\u0275\u0275advance"](2),O["\u0275\u0275textInterpolate"](O["\u0275\u0275pipeBind2"](14,7,e.StartDateTime,"medium")),O["\u0275\u0275advance"](3),O["\u0275\u0275textInterpolate"](O["\u0275\u0275pipeBind2"](17,10,e.EndDateTime,"medium"))}}function q(e,t){if(1&e&&(O["\u0275\u0275elementContainerStart"](0),O["\u0275\u0275template"](1,Q,18,13,"ng-container",29),O["\u0275\u0275pipe"](2,"slice"),O["\u0275\u0275elementContainerEnd"]()),2&e){const e=O["\u0275\u0275nextContext"](2);O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngForOf",O["\u0275\u0275pipeBind3"](2,2,e.snapshotImports,(e.paginationCurrentPage-1)*e.paginationPageSize,e.paginationCurrentPage*e.paginationPageSize))("ngForTrackBy",e.trackBySnapshotId)}}function G(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementStart"](0,"tr"),O["\u0275\u0275elementStart"](1,"td",31),O["\u0275\u0275elementStart"](2,"ngx-table-empty-state",32),O["\u0275\u0275listener"]("clearSearchClick",function(){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"](2).clearSearch()})("clearFiltersClick",function(){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"](2).clearFilters()}),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"]()}if(2&e){O["\u0275\u0275nextContext"]();const e=O["\u0275\u0275reference"](16),t=O["\u0275\u0275nextContext"]();O["\u0275\u0275advance"](1),O["\u0275\u0275attribute"]("colspan",e.children.length),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("filterState",t.filterState)}}function W(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementStart"](0,"ngb-pagination",33),O["\u0275\u0275listener"]("pageChange",function(t){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"](2).paginationCurrentPage=t}),O["\u0275\u0275elementEnd"]()}if(2&e){const e=O["\u0275\u0275nextContext"](2);O["\u0275\u0275property"]("page",e.paginationCurrentPage)("collectionSize",e.snapshotImports.length)("maxSize",e.paginationMaxSize)("boundaryLinks",!0)("pageSize",e.paginationPageSize)}}function X(e,t){if(1&e&&(O["\u0275\u0275elementStart"](0,"nb-option",36),O["\u0275\u0275text"](1),O["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;O["\u0275\u0275property"]("value",e),O["\u0275\u0275advance"](1),O["\u0275\u0275textInterpolate1"](" ",e," ")}}function J(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementStart"](0,"nb-select",34),O["\u0275\u0275listener"]("ngModelChange",function(t){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"](2).paginationPageSize=t})("selectedChange",function(){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"](2).saveLocalConfig()}),O["\u0275\u0275template"](1,X,2,2,"nb-option",35),O["\u0275\u0275elementEnd"]()}if(2&e){const e=O["\u0275\u0275nextContext"](2);O["\u0275\u0275property"]("ngModel",e.paginationPageSize),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngForOf",e.rowsPerPageOptions)}}const Y=function(e){return{"c-pointer":e}},Z=function(e){return{sortKey:e,label:"Tenant name",filterName:"SceneName"}},ee=function(e){return{sortKey:e,label:"User principal name",filterName:"AssignedUserPrincipalNameResolved"}},te=function(e){return{sortKey:e,label:"Usage status",filterName:"UsageStatus"}},ne=function(e){return{sortKey:e,label:"Import status",filterName:"ImportStatus"}},re=function(e){return{sortKey:e,label:"Start date",hideFilter:!0}},ie=function(e){return{sortKey:e,label:"End date",hideFilter:!0}};function se(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementContainerStart"](0),O["\u0275\u0275elementStart"](1,"div",3),O["\u0275\u0275elementStart"](2,"div",4),O["\u0275\u0275elementStart"](3,"label",5),O["\u0275\u0275elementStart"](4,"div",6),O["\u0275\u0275elementStart"](5,"nb-form-field"),O["\u0275\u0275element"](6,"input",7),O["\u0275\u0275template"](7,L,2,0,"button",8),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](8,"div",9),O["\u0275\u0275elementStart"](9,"nb-actions",10),O["\u0275\u0275elementStart"](10,"nb-action",11),O["\u0275\u0275listener"]("click",function(){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"]().deleteSelectedSnapshots()}),O["\u0275\u0275element"](11,"nb-icon",12),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](12,"div",13),O["\u0275\u0275elementStart"](13,"table",14),O["\u0275\u0275elementStart"](14,"thead"),O["\u0275\u0275elementStart"](15,"tr",15,16),O["\u0275\u0275elementStart"](17,"th",17),O["\u0275\u0275elementStart"](18,"nb-checkbox",18),O["\u0275\u0275listener"]("checkedChange",function(t){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"]().selectAll(t)}),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275template"](19,R,1,0,"ng-container",19),O["\u0275\u0275template"](20,U,1,0,"ng-container",19),O["\u0275\u0275template"](21,j,1,0,"ng-container",19),O["\u0275\u0275template"](22,$,1,0,"ng-container",19),O["\u0275\u0275template"](23,K,1,0,"ng-container",19),O["\u0275\u0275template"](24,H,1,0,"ng-container",19),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](25,"tbody"),O["\u0275\u0275template"](26,q,3,6,"ng-container",0),O["\u0275\u0275template"](27,G,3,2,"tr",0),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275template"](28,W,1,5,"ngb-pagination",20),O["\u0275\u0275elementStart"](29,"div",21),O["\u0275\u0275template"](30,J,2,2,"nb-select",22),O["\u0275\u0275elementStart"](31,"button",23),O["\u0275\u0275listener"]("click",function(){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"]().selectPage()}),O["\u0275\u0275element"](32,"nb-icon",24),O["\u0275\u0275text"](33," Select page "),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](34,"button",25),O["\u0275\u0275listener"]("click",function(){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"]().update()}),O["\u0275\u0275element"](35,"nb-icon",26),O["\u0275\u0275text"](36," Update "),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=O["\u0275\u0275nextContext"](),t=O["\u0275\u0275reference"](8);O["\u0275\u0275advance"](6),O["\u0275\u0275property"]("formControl",e.searchFormControl),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngIf",e.searchFormControl.value),O["\u0275\u0275advance"](3),O["\u0275\u0275propertyInterpolate"]("nbTooltip",e.hasSelectedSnapshots?"Delete":"Select at least one item in the table to delete migration snapshots"),O["\u0275\u0275property"]("disabled",!e.hasSelectedSnapshots)("ngClass",O["\u0275\u0275pureFunction1"](23,Y,e.hasSelectedSnapshots)),O["\u0275\u0275advance"](8),O["\u0275\u0275property"]("checked",e.areAllChecked)("indeterminate",e.isIntermediateState),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngTemplateOutlet",t)("ngTemplateOutletContext",O["\u0275\u0275pureFunction1"](25,Z,e.sortKeys.TenantName)),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngTemplateOutlet",t)("ngTemplateOutletContext",O["\u0275\u0275pureFunction1"](27,ee,e.sortKeys.AssignedUserPrincipalName)),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngTemplateOutlet",t)("ngTemplateOutletContext",O["\u0275\u0275pureFunction1"](29,te,e.sortKeys.UsageStatus)),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngTemplateOutlet",t)("ngTemplateOutletContext",O["\u0275\u0275pureFunction1"](31,ne,e.sortKeys.ImportStatus)),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngTemplateOutlet",t)("ngTemplateOutletContext",O["\u0275\u0275pureFunction1"](33,re,e.sortKeys.StartDate)),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngTemplateOutlet",t)("ngTemplateOutletContext",O["\u0275\u0275pureFunction1"](35,ie,e.sortKeys.EndDate)),O["\u0275\u0275advance"](2),O["\u0275\u0275property"]("ngIf",e.snapshotImports.length),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngIf",e.isEmptyStateVisible),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngIf",e.snapshotImports.length>e.MAX_LENGTH_TO_SHOW_ELEMENT),O["\u0275\u0275advance"](2),O["\u0275\u0275property"]("ngIf",e.snapshotImports.length>e.MAX_LENGTH_TO_SHOW_ELEMENT)}}function ae(e,t){1&e&&O["\u0275\u0275elementContainer"](0)}function oe(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementStart"](0,"ngx-snapshot-imports-filter-trigger",41),O["\u0275\u0275listener"]("filtersChanges",function(t){return O["\u0275\u0275restoreView"](e),O["\u0275\u0275nextContext"](2).populateFiltersSet(t)}),O["\u0275\u0275elementEnd"]()}if(2&e){const e=O["\u0275\u0275nextContext"](),t=e.sortKey,n=e.filterName,r=O["\u0275\u0275nextContext"]();O["\u0275\u0275property"]("resourcePath",t)("filterName",n)("dataSource",r.snapshotImports)}}const le=function(e){return{$implicit:e}};function ce(e,t){if(1&e){const e=O["\u0275\u0275getCurrentView"]();O["\u0275\u0275elementStart"](0,"th",37),O["\u0275\u0275listener"]("click",function(){const t=O["\u0275\u0275restoreView"](e).sortKey;return O["\u0275\u0275nextContext"]().toggleSort(t)}),O["\u0275\u0275elementStart"](1,"div",38),O["\u0275\u0275elementStart"](2,"span"),O["\u0275\u0275text"](3),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](4,"div",39),O["\u0275\u0275template"](5,ae,1,0,"ng-container",19),O["\u0275\u0275template"](6,oe,1,3,"ngx-snapshot-imports-filter-trigger",40),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"]()}if(2&e){const e=t.sortKey,n=t.label,r=t.hideFilter;O["\u0275\u0275nextContext"]();const i=O["\u0275\u0275reference"](10);O["\u0275\u0275advance"](3),O["\u0275\u0275textInterpolate"](n),O["\u0275\u0275advance"](2),O["\u0275\u0275property"]("ngTemplateOutlet",i)("ngTemplateOutletContext",O["\u0275\u0275pureFunction1"](4,le,e)),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngIf",!r)}}function pe(e,t){if(1&e&&(O["\u0275\u0275elementContainerStart"](0),O["\u0275\u0275element"](1,"nb-icon",42),O["\u0275\u0275elementContainerEnd"]()),2&e){const e=O["\u0275\u0275nextContext"](2);O["\u0275\u0275advance"](1),O["\u0275\u0275propertyInterpolate"]("nbTooltip","asc"===e.sortDirection?"Sorted ascending":"Sorted descending"),O["\u0275\u0275propertyInterpolate1"]("icon","arrow-","asc"===e.sortDirection?"down":"up","")}}function de(e,t){if(1&e&&O["\u0275\u0275template"](0,pe,2,2,"ng-container",0),2&e){const e=t.$implicit,n=O["\u0275\u0275nextContext"]();O["\u0275\u0275property"]("ngIf",n.sortColumn===e)}}const he=[{path:"**",redirectTo:"migration-snapshots",pathMatch:"full"},{path:"",component:(()=>{class e{constructor(e,t,n,r){this.wd365Service=e,this.toastrService=t,this.actionsService=n,this.dialogService=r,this.destroyed$=new s.xQ,this.filterState={searchQuery:"",columnFilters:{}},this.selectedSnapshotIds=new Set,this.selectedSnapshots=[],this.rowsPerPageOptions=[20,50,80,100,150,200],this.MAX_LENGTH_TO_SHOW_ELEMENT=20,this.isEmptyStateVisible=!1,this.snapshotImports$=new s.xQ,this.snapshotImports=[],this.snapshotImportsCache=[],this.isLoading=!1,this.searchFormControl=new P.NI(""),this.paginationCurrentPage=1,this.paginationPageSize=this.rowsPerPageOptions[0],this.paginationMaxSize=10,this.sortKeys=F,this.sortColumn="",this.sortDirection="asc",this.trackBySnapshotId=(e,t)=>t.SnapshotId,this.retryApiCallWithToastCallback=e=>e.pipe((0,f.b)(e=>this.showDangerToast("Failure accessing the API",`Cannot read data from API. The message is: ${e.message} with status ${e.statusText}`)),(0,S.j)(()=>(0,a.H)(k.e5))),this.handleApiErrorCallback=e=>(0,o._)(()=>(this.showDangerToast("Failure accessing the API",`Cannot read data from API. Reload this site to try it again. The message is: ${e.message} with status ${e.statusText}`),(0,l.of)([])))}get hasSelectedSnapshots(){return this.selectedSnapshots.length>0}get areAllChecked(){return this.snapshotImports.length>0&&this.snapshotImports.every(e=>e.IsSelected)}get isIntermediateState(){const e=this.snapshotImports.filter(e=>e.IsSelected).length;return e>0&&e<this.snapshotImports.length}ngOnInit(){this.loadPageSizeFromLocalStorage(),this.initMigrationSnapshots(),this.initTableSearch()}loadPageSizeFromLocalStorage(){const e=localStorage.getItem("Hydra.SnapshotImports.PageSize");e&&Number(e)&&(this.paginationPageSize=Number(e))}toggleSort(e){this.sortColumn===e?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=e,this.sortDirection="asc"),this.applySorting()}selectionChanged(e,t){e.IsSelected=t,t?this.selectedSnapshotIds.add(e.SnapshotId):this.selectedSnapshotIds.delete(e.SnapshotId),this.countSelected()}deleteSelectedSnapshots(){if(!this.hasSelectedSnapshots)return;const{onClose:e}=this.dialogService.open(T.z,{context:{headerTitle:"Delete migration snapshot(s)",bodyText:`Please confirm deletion of ${this.selectedSnapshots.length} migration snapshot(s)`,cancelButtonText:"Cancel",confirmButtonText:"Delete"},hasScroll:!1,closeOnEsc:!1,closeOnBackdropClick:!1});e.pipe((0,p.h)(Boolean),(0,C.w)(()=>(0,c.D)(this.selectedSnapshots).pipe((0,y.zg)(e=>this.actionsService.sendActionAsync(`scenes/${e.SceneId}/win365/snapshotImports/${e.SnapshotId}/deletecloudpcsnapshotimport`,null,"Delete snapshot import",e.AssignedUserPrincipalNameResolved),3))),(0,v.x)(()=>this.update()),(0,d.R)(this.destroyed$)).subscribe()}selectAll(e){e?this.selectAllOnPage(this.snapshotImports):this.deselectAllOnPage(this.snapshotImports),this.countSelected()}selectPage(){const e=this.getSnapshotsPageSlice();e.every(e=>e.IsSelected)?this.deselectAllOnPage(e):this.selectAllOnPage(e),this.countSelected()}clearSearch(){this.searchFormControl.setValue("")}clearFilters(){var e;this.filterState={...this.filterState,columnFilters:{}},this.paginationCurrentPage=1,null===(e=this.filterTriggers)||void 0===e||e.forEach(e=>e.resetAllFilters()),this.applyAllFilters()}saveLocalConfig(){localStorage.setItem("Hydra.SnapshotImports.PageSize",this.paginationPageSize.toString())}update(){this.snapshotImports$.next()}populateFiltersSet([e,t]){this.filterState.columnFilters[t]=e.filter(e=>e.checked).map(e=>e.label.toLowerCase()),this.applyAllFilters()}countSelected(){this.selectedSnapshots=this.snapshotImports.filter(e=>e.IsSelected)}getSnapshotsPageSlice(){return this.snapshotImports.slice((this.paginationCurrentPage-1)*this.paginationPageSize,this.paginationCurrentPage*this.paginationPageSize)}selectAllOnPage(e){e.forEach(e=>{e.IsSelected=!0,this.selectedSnapshotIds.add(e.SnapshotId)})}deselectAllOnPage(e){e.forEach(e=>{e.IsSelected=!1,this.selectedSnapshotIds.delete(e.SnapshotId)})}preserveSelection(e){return e.map(e=>({...e,IsSelected:this.selectedSnapshotIds.has(e.SnapshotId)}))}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}initMigrationSnapshots(){this.isLoading=!0,this.snapshotImports$.pipe((0,h.O)(0),(0,C.w)(()=>(0,a.H)(0,x.tc.autoRefreshDefault)),(0,C.w)(()=>this.wd365Service.getClouPcMigrationSnapshots()),(0,b.a)(this.retryApiCallWithToastCallback),(0,u.K)(this.handleApiErrorCallback),(0,d.R)(this.destroyed$)).subscribe(e=>{const t=this.preserveSelection(e);this.snapshotImportsCache=[...t],this.applyAllFilters(),this.isLoading=!1,this.updateEmptyStateVisibility()})}updateEmptyStateVisibility(){this.isEmptyStateVisible=!this.isLoading&&0===this.snapshotImports.length}initTableSearch(){this.searchFormControl.valueChanges.pipe((0,m.b)(k.XU),(0,g.x)(),(0,d.R)(this.destroyed$)).subscribe((e="")=>{this.filterState.searchQuery=e.trim(),this.applyAllFilters()})}applyAllFilters(){this.paginationCurrentPage=1;let e=[...this.snapshotImportsCache];Object.keys(this.filterState.columnFilters).some(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0})&&(e=this.applyColumnFilters(e)),this.filterState.searchQuery&&(e=this.applySearchFilter(e)),this.snapshotImports=e,this.updateEmptyStateVisibility(),this.applySorting()}applySorting(){this.sortColumn&&this.sortByPropertyPath(this.sortColumn)}applyColumnFilters(e){const t=Object.keys(this.filterState.columnFilters).filter(e=>{var t;return(null===(t=this.filterState.columnFilters[e])||void 0===t?void 0:t.length)>0});return t.length?e.filter(e=>t.every(t=>{var n;const r=this.filterState.columnFilters[t],i=null===(n=function(e,t){switch(t){case"SceneName":return e.SceneName;case"AssignedUserPrincipalNameResolved":return e.AssignedUserPrincipalNameResolved;case"UsageStatus":return e.UsageStatus;case"ImportStatus":return e.ImportStatus;default:return""}}(e,t))||void 0===n?void 0:n.toLowerCase();return r.includes(i)})):e}applySearchFilter(e){var t;const n=null===(t=this.filterState)||void 0===t?void 0:t.searchQuery.toLowerCase();return e.filter(e=>{var t,r,i,s,a,o;const l=null!==(r=null===(t=e.SceneName)||void 0===t?void 0:t.toLowerCase())&&void 0!==r?r:"",c=null!==(s=null===(i=e.AssignedUserPrincipalNameResolved)||void 0===i?void 0:i.toLowerCase())&&void 0!==s?s:"",p=null!==(a=e.UsageStatus.toLowerCase())&&void 0!==a?a:"",d=null!==(o=e.ImportStatus.toLowerCase())&&void 0!==o?o:"";return(null==l?void 0:l.includes(n))||(null==c?void 0:c.includes(n))||(null==p?void 0:p.includes(n))||(null==d?void 0:d.includes(n))})}sortByPropertyPath(e){const t=e.split(".");console.log(t),this.snapshotImports.sort((e,n)=>{let r=this.getNestedProperty(e,t),i=this.getNestedProperty(n,t);return console.log(r),console.log(i),r=null==r?"":r,i=null==i?"":i,"asc"===this.sortDirection?r>i?1:r<i?-1:0:r<i?1:r>i?-1:0})}getNestedProperty(e,t){return t.reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}showDangerToast(e,t){this.toastrService.danger(t,e,{destroyByClick:!0,duration:2e4,hasIcon:!0,position:I.fe3.TOP_RIGHT,preventDuplicates:!0})}}return e.\u0275fac=function(t){return new(t||e)(O["\u0275\u0275directiveInject"](E.G),O["\u0275\u0275directiveInject"](I.quB),O["\u0275\u0275directiveInject"](w.c),O["\u0275\u0275directiveInject"](I.Gln))},e.\u0275cmp=O["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-snapshotImports"]],viewQuery:function(e,t){if(1&e&&O["\u0275\u0275viewQuery"](V,5),2&e){let e;O["\u0275\u0275queryRefresh"](e=O["\u0275\u0275loadQuery"]())&&(t.filterTriggers=e)}},decls:11,vars:2,consts:[[4,"ngIf"],["tableHeaderCellTpl",""],["sortTableIconTpl",""],[1,"row"],[1,"col-md-5"],["for","search_query",1,"w-100"],[1,"search-input-wrapper"],["id","search_query","type","text","placeholder","Search for tenant, user principal name, or status","nbInput","","fullWidth","",1,"search-input",3,"formControl"],["nbTooltip","Clear search","nbSuffix","","nbButton","","ghost","",3,"click",4,"ngIf"],[1,"col-md-7","d-flex","justify-content-end"],["size","small"],["nbTooltipPlacement","top",3,"disabled","ngClass","nbTooltip","click"],["icon","trash-2-outline"],[1,"table-responsive"],[1,"table","table-bordered","table-striped"],[1,"align-top"],["headerRow",""],[1,"align-top","skip-sorting"],[3,"checked","indeterminate","checkedChange"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","d-flex justify-content-center",3,"page","collectionSize","maxSize","boundaryLinks","pageSize","pageChange",4,"ngIf"],[1,"d-flex","justify-content-center","p-2"],["nbTooltip","How many rows to list on one page",3,"ngModel","ngModelChange","selectedChange",4,"ngIf"],["type","button","nbButton","","nbTooltip","Select all migration snapshots on this page",3,"click"],["icon","checkmark-square"],["type","button","nbButton","","status","semi-round",3,"click"],["icon","refresh"],["nbTooltip","Clear search","nbSuffix","","nbButton","","ghost","",3,"click"],["icon","close-outline"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"checked","checkedChange"],[1,"text-center","p-5"],[3,"filterState","clearSearchClick","clearFiltersClick"],[1,"d-flex","justify-content-center",3,"page","collectionSize","maxSize","boundaryLinks","pageSize","pageChange"],["nbTooltip","How many rows to list on one page",3,"ngModel","ngModelChange","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"align-top",3,"click"],[1,"d-flex","justify-content-between"],[1,"d-flex","align-items-center"],[3,"resourcePath","filterName","dataSource","filtersChanges",4,"ngIf"],[3,"resourcePath","filterName","dataSource","filtersChanges"],[1,"sort-direction-icon","mr-1",3,"nbTooltip","icon"]],template:function(e,t){1&e&&(O["\u0275\u0275elementStart"](0,"nb-card"),O["\u0275\u0275elementStart"](1,"nb-card-header"),O["\u0275\u0275elementStart"](2,"h1"),O["\u0275\u0275text"](3,"Migration snapshots"),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementStart"](4,"nb-card-body"),O["\u0275\u0275template"](5,B,1,0,"nb-spinner",0),O["\u0275\u0275template"](6,se,37,37,"ng-container",0),O["\u0275\u0275elementEnd"](),O["\u0275\u0275elementEnd"](),O["\u0275\u0275template"](7,ce,7,6,"ng-template",null,1,O["\u0275\u0275templateRefExtractor"]),O["\u0275\u0275template"](9,de,1,1,"ng-template",null,2,O["\u0275\u0275templateRefExtractor"])),2&e&&(O["\u0275\u0275advance"](5),O["\u0275\u0275property"]("ngIf",t.isLoading),O["\u0275\u0275advance"](1),O["\u0275\u0275property"]("ngIf",!t.isLoading))},directives:[I.Asz,I.ndF,I.yKW,r.O5,I.Tzq,I.jBG,I.h8i,P.Fj,P.JJ,P.oH,I.lYD,I.Bk3,r.mk,I.jNv,I.fMN,I.NTf,r.tP,I.DPz,I.yyc,r.sg,_.$,D.N9,I.rs,P.On,I.q51,V],pipes:[r.OU,r.uU],styles:["[_nghost-%COMP%]{height:100%}[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   .table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(.skip-sorting){-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer}[_nghost-%COMP%]   .sort-direction-icon[_ngcontent-%COMP%]{font-size:1em;cursor:default}"]}),e})()}];let ue=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=O["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=O["\u0275\u0275defineInjector"]({imports:[[i.Bz.forChild(he)],i.Bz]}),e})();var me=n(66911),ge=n(61367),fe=n(88100);let Se=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=O["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=O["\u0275\u0275defineInjector"]({imports:[[r.ez,ue,me.m,P.u5,I.zyh,I.KdK,D.jF,I.T2N,I.uuI,I.MAY,I.MfT,I.nKr,I.rgH,P.UX,ge.H,fe.Z,I.spT,I.x4g,I.IIj,I.V7y,fe.Z]]}),e})()}}]);